---
title: "wOBA for Softball"
author: "Matthew Brownsword"
date: "4/19/2017"
output:
  pdf_document: default
  html_document: default
  word_document: default
---

# Code appendix

This contains most, if not all, of the set-up code necessary to explain the data, analyze results and generate discussion. 

#Set-up

```{r}
# Change on your machine
library(mosaic)
library(knitr)

getwd()
setwd("/Users/mbrownsword/Downloads")



## Easy way to look for and install missing packages and load them
if (!require("pacman")){ install.packages("pacman") }
pacman::p_load("knitr","mosaic","plyr","ggplot2","foreign","gridExtra")

## Set some default options R Markdown
opts_chunk$set(tidy=TRUE,echo=FALSE,results='markup',strip.white=TRUE,cache=T,highlight=TRUE,width.cutoff=132,size='footnotesize',message=FALSE,warning=TRUE,comment=NA)
knitr::opts_chunk$set(echo =TRUE)
library(pander)
install.packages("tables", repos='http://cran.us.r-project.org')

# Default options in R
options(digits=4,width=100,scipen=12)

load("Softball_Stats2016.rda")
load("BaseballOStats2016.rda")
load("Softball_Stats2015.rda")
load("Softball_Stats2014.rda")

Sys.setenv(PATH=paste("/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/local/texlive/2016/bin/x86_64-darwin"))
Sys.getenv("PATH")
Sys.which("pdflatex")

```

#1

```{r}

Softball_Stats2016[is.na(Softball_Stats2016)] <- 0


# Creating a marker for wOBA
Softball_Stats2016$oneB<-with(Softball_Stats2016, H-twoB-threeB-HR)
Softball_Stats2016$RBOE<-with(Softball_Stats2016, AB-GO-FO-K-H+SF+SH)

Softball_Stats2016$wOBA<-with(Softball_Stats2016,(.72*BB+.75*HBP+.90*oneB+1.24*twoB+1.56*threeB+1.95*HR+.92*RBOE)/(AB+BB+IBB+SH+SF+HBP), na.rm = T)

# Creating a function marking winning % and wOBA
lmwSoftballOBA2016<-lm(with(Softball_Stats2016, PCT~wOBA))
lmwSoftballOBA2016
lmwSoftballOBA2016R<-lm(with(Softball_Stats2016, R~wOBA))
lmwSoftballOBA2016R

#Looking at the distribution of Softball wOBAs, looks normal
hist(Softball_Stats2016$wOBA)




#Repeat the process for 2016 baseball statistics
BaseballOStats2016$oneB<-with(BaseballOStats2016, H-twoB-threeB-HR)

BaseballOStats2016$wOBA<-with(BaseballOStats2016, (.72*BB+.75*HBP+.90*oneB+1.24*twoB+1.56*threeB+1.95*HR)/(AB+BB+SH+SF+HBP), na.rm = T)
lmwBaseballOBA2016<-lm(with(BaseballOStats2016, R~wOBA))
lmwBaseballOBA2016
hist(BaseballOStats2016$wOBA)

plot(x= BaseballOStats2016$wOBA, y=BaseballOStats2016$R,
     xlab="wOBA", ylab = "R")
abline(lmwBaseballOBA2016,col="red")
rsquared(lmwBaseballOBA2016)

##2015

Softball_Stats2015[is.na(Softball_Stats2015)] <- 0


# Creating a marker for wOBA
Softball_Stats2015$oneB<-with(Softball_Stats2015, H-twoB-threeB-HR)
Softball_Stats2015$RBOE<-with(Softball_Stats2015, AB-GO-FO-K-H+SF+SH)

Softball_Stats2015$wOBA<-with(Softball_Stats2015,(.72*BB+.75*HBP+.90*oneB+1.24*twoB+1.56*threeB+1.95*HR+.92*RBOE)/(AB+BB+IBB+SH+SF+HBP), na.rm = T)

# Creating a function marking winning % and wOBA
lmwSoftballOBA2015<-lm(with(Softball_Stats2015, PCT~wOBA))
lmwSoftballOBA2015
lmwSoftballOBA2015R<-lm(with(Softball_Stats2015, R~wOBA))
lmwSoftballOBA2015R

#Looking at the distribution of Softball wOBAs, looks normal
hist(Softball_Stats2015$wOBA)

#Plot the function with the dataset
plot(x= Softball_Stats2015$wOBA, y=Softball_Stats2015$PCT,
     xlab="wOBA", ylab = "PCT")
abline(lmwSoftballOBA2015,col="red")
rsquared(lmwSoftballOBA2015)

#Plot the function with the dataset
plot(x= Softball_Stats2015$wOBA, y=Softball_Stats2015$R,
     xlab="wOBA", ylab = "R")
abline(lmwSoftballOBA2015R,col="red")
rsquared(lmwSoftballOBA2015R)

##2014

Softball_Stats2014[is.na(Softball_Stats2014)] <- 0

# Creating a marker for wOBA
Softball_Stats2014$oneB<-with(Softball_Stats2014, H-twoB-threeB-HR)
Softball_Stats2014$RBOE<-with(Softball_Stats2014, AB-GO-FO-K-H+SF+SH)

Softball_Stats2014$wOBA<-with(Softball_Stats2014,(.72*BB+.75*HBP+.90*oneB+1.24*twoB+1.56*threeB+1.95*HR+.92*RBOE)/(AB+BB+IBB+SH+SF+HBP), na.rm = T)

# Creating a function marking winning % and wOBA
lmwSoftballOBA2014<-lm(with(Softball_Stats2014, PCT~wOBA))
lmwSoftballOBA2014
lmwSoftballOBA2014R<-lm(with(Softball_Stats2014, R~wOBA))
lmwSoftballOBA2014R

#Plot the function with the dataset
plot(x= Softball_Stats2014$wOBA, y=Softball_Stats2014$PCT,
     xlab="wOBA", ylab = "PCT")
abline(lmwSoftballOBA2014,col="red")
rsquared(lmwSoftballOBA2014)

#Plot the function with the dataset
plot(x= Softball_Stats2014$wOBA, y=Softball_Stats2014$R,
     xlab="wOBA", ylab = "R")
abline(lmwSoftballOBA2014R,col="red")
rsquared(lmwSoftballOBA2014R)





```

#2

```{r}

save(Softball_Stats2016,file="Softball_Stats2016.rda")
save(Softball_Stats2015,file="Softball_Stats2015.rda")
save(Softball_Stats2014,file="Softball_Stats2014.rda")
```


#3
```{r}
# Load data
load("NCAAPBP.rda")
head(NCAAPBP)
length(unique(NCAAPBP$gameID))
# 2071 games
# Tons of missing data here, not sure what's up
sum(is.na(NCAAPBP$gameID))
# Getting rid of it for now
season<-NCAAPBP[!is.na(NCAAPBP$gameID),]
season$play<-trimws(season$playID)
# Create a measure of outs

sum(grepl("[[:space:]]out[[:punct:]]",season$play))
sum(grepl("[[:space:]]out[[:space:]]| popped |[[:space:]]out[:punct:]",season$play))


sum(grepl("double play",season$play))
# No Triple Plays
sum(grepl("triple play",season$play))
sum(grepl("struck out swinging reached",season$play))
sum(grepl("[[:space:]]out.*reached",season$play))


# 
sum(grepl("[[:space:]]out.*reached",season$play))

season$play[grepl("[[:space:]]out.*reached",season$play)]
season$play[grepl("outh",season$play)]

# How many outs occurred because of play
season$outs_from_play<-as.numeric(grepl("[[:space:]]out[[:space:]]| popped |[[:space:]]out[[:punct:]]",season$play))
table(season$outs_from_play)
season$outs_from_play[grepl("double play",season$play)]<-2
# Remove people who reached after striking out
season$outs_from_play[grepl("[[:space:]]out.*reached",season$play)]<-0
season$outs_from_play[grepl("struck out reached",season$play)]<-0

table(season$outs_from_play)

# Remove inning summaries
season$play[1:11]
inning_summaries<-season[grepl("R: ",season$play),]
season<-season[!grepl("R: ",season$play),]

#Taking out non-plays in the data

season<-season[!((grepl("to[[:space:]][[:alpha:]][[:alpha:]][[:space:]]for",season$play))),]
season<-season[!(grepl("to[[:space:]][[:digit:]][[:alpha:]][[:space:]]for",season$play)),]
season<-season[!(grepl("to[[:space:]][[:alpha:]][[:space:]]for",season$play)),]
season<-season[!(grepl("pinch[[:space:]]ran",season$play)),]
season<-season[!(grepl("pinch[[:space:]]hit",season$play)),]
season<-season[!((grepl("\\S[^[:space:]o][^0-9u][^t][[:space:]]to[[:space:]][[:alpha:]][[:alpha:]][[:punct:]]",season$play))),]
season<-season[!(grepl("\\S[^[:space:]o][^u][^t][[:space:]]to[[:space:]][[:digit:]][[:alpha:]][[:punct:]]",season$play)),]
season<-season[!(grepl("\\S[^[:space:]o][^u][^t][[:space:]]to[[:space:]][[:alpha:]][[:punct:]]",season$play)),]
season<-season[!((grepl("\\S[^u][^p][[:space:]]to[[:space:]][[:alpha:]][[:alpha:]][[:punct:]]",season$play))),]
season<-season[!(grepl("\\S[^u][^p][[:space:]]to[[:space:]][[:digit:]][[:alpha:]][[:punct:]]",season$play)),]
season<-season[!(grepl("\\S[^u][^p][[:space:]]to[[:space:]][[:alpha:]][[:punct:]]",season$play)),]

season<-season[!(grepl("to[[:space:]]dh[[:punct:]]",season$play)),]
season<-season[!(grepl("No[[:space:]]play[[:punct:]]",season$play)),]

```

#4

```{r}
games<-unique(season$gameID)

game<-season[season$gameID==games[1],]
dim(game) 
# 71 plays
# Look at Inning ID
table(game$inningID)
# Only five innings due to run-rule
innings<-unique(game$inningID)
# Look at plays for one inning

game$play[game$inningID==3]
game$play[game$inningID==3&game$outs_from_play==1]
game$outs_from_play



# Look at outs in one inning
game$outs1[game$inningID==0]
game$outs_from_play[game$inningID==3]

# Total outs in inning
game$total_outs_in_inning<-NA
for(i in innings){
       game$total_outs_in_inning[game$inningID==i]<-cumsum(game$outs_from_play[game$inningID==i])
    }
# Create an initial indicator of top and bottom
game$top_bottom[game$total_outs_in_inning<4]<-"top"
game$top_bottom[game$total_outs_in_inning>3]<-"bottom"

# Create empty vector for Total outs before play
game$outs_before_play<-0

# Total outs before play in top of Inning
for(i in innings){
        n<-length(game$outs_before_play[game$inningID==i&game$top_bottom=="top"])
       game$outs_before_play[game$inningID==i&game$top_bottom=="top"][2:n]<-cumsum(game$outs_from_play[game$inningID==i&game$top_bottom=="top"][1:n-1])
       game$outs_before_play[game$inningID==i&game$top_bottom=="top"][1]<-0
    }
# Total outs before play in bottom of Inning
for(i in innings){
        n<-length(game$outs_before_play[game$inningID==i&game$top_bottom=="bottom"])
       game$outs_before_play[game$inningID==i&game$top_bottom=="bottom"][2:n]<-cumsum(game$outs_from_play[game$inningID==i&game$top_bottom=="bottom"][1:n-1])
       game$outs_before_play[game$inningID==i&game$top_bottom=="bottom"][1]<-0
    }

# Fix shift from top to bottom of inning

game$top_bottom[game$outs_before_play==3]<-"bottom"

# Redo to get correct number of outs for each inning
# Top of Inning
for(i in innings){
        n<-length(game$outs_before_play[game$inningID==i&game$top_bottom=="top"])
       game$outs_before_play[game$inningID==i&game$top_bottom=="top"][2:n]<-cumsum(game$outs_from_play[game$inningID==i&game$top_bottom=="top"][1:n-1])
       game$outs_before_play[game$inningID==i&game$top_bottom=="top"][1]<-0
    }
# Bottom of Inning
for(i in innings){
        n<-length(game$outs_before_play[game$inningID==i&game$top_bottom=="bottom"])
       game$outs_before_play[game$inningID==i&game$top_bottom=="bottom"][2:n]<-cumsum(game$outs_from_play[game$inningID==i&game$top_bottom=="bottom"][1:n-1])
       game$outs_before_play[game$inningID==i&game$top_bottom=="bottom"][1]<-0
    }



# Check

game[game$inningID==0,c("play","top_bottom","outs_from_play","outs_before_play","total_outs_in_inning")]

game[game$inningID==1,c("play","top_bottom","outs_from_play","outs_before_play","total_outs_in_inning")]

game[game$inningID==2,c("play","top_bottom","outs_from_play","outs_before_play","total_outs_in_inning")]


game[game$inningID==3,c("play","top_bottom","outs_from_play","outs_before_play","total_outs_in_inning")]

game[game$inningID==4,c("play","top_bottom","outs_from_play","outs_before_play","total_outs_in_inning")]


```
#5

```{r}

games<-unique(season$gameID)
#games<-sample(games,100)
# Total outs in inning
season$total_outs_in_inning<-NA
for(k in games){
    innings<-unique(season$inningID[season$gameID==k])
for(i in innings){
       season$total_outs_in_inning[season$inningID==i&season$gameID==k
]<-cumsum(season$outs_from_play[season$inningID==i&season$gameID==k
])
}
}

season$top_bottom<-NA
season$top_bottom[season$total_outs_in_inning<4]<-"top"
season$top_bottom[season$total_outs_in_inning>3]<-"bottom"

# Total outs before play
season$outs_before_play<-0

# Top of Inning
for(k in games){
        innings<-unique(season$inningID[season$gameID==k])
for(i in innings){
        n<-length(season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"])
        if(n==1){
            season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][1]<-0
        }else{
       season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][2:n]<-cumsum(season$outs_from_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][1:n-1])
       season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][1]<-0
    }}}
# Bottom of Inning
for(k in games){
        innings<-unique(season$inningID[season$gameID==k])
for(i in innings){
        n<-length(season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"])
        if(n==1){
            season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][1]<-0
        }else{
       season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][2:n]<-cumsum(season$outs_from_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][1:n-1])
       season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][1]<-0
    }}}

# Fix transition from top to bottom
season$top_bottom[season$outs_before_play==3]<-"bottom"


# Top of Inning
for(k in games){
        innings<-unique(season$inningID[season$gameID==k])
for(i in innings){
        n<-length(season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"])
        if(n==1){
            season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][1]<-0
        }else{
       season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][2:n]<-cumsum(season$outs_from_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][1:n-1])
       season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][1]<-0
}}}
# Bottom of Inning
for(k in games){
        innings<-unique(season$inningID[season$gameID==k])
for(i in innings){
        n<-length(season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"])
         if(n==1){
            season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][1]<-0
        }else{
       season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][2:n]<-cumsum(season$outs_from_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][1:n-1])
       season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][1]<-0
}}}

# Check
game[game$inningID==4,c("play","top_bottom","outs_from_play","outs_before_play","total_outs_in_inning")]==season[season$gameID==games[1]&season$inningID==4,c("play","top_bottom","outs_from_play","outs_before_play","total_outs_in_inning")]

# Look at Random Game
season[season$gameID==games[24]&season$inningID==3,c("play","top_bottom","outs_from_play","outs_before_play","total_outs_in_inning")]
summary(season$outs_before_play)
table(season$outs_before_play)
season$gameID[season$outs_before_play==3]







#Games found to be problematic after calculating outs
season<-season[!(season$gameID==4019409),]
season<-season[!(season$gameID==4011385),]
season<-season[!(season$gameID==4014180),]
season<-season[!(season$gameID==4017578),]
season<-season[!(season$gameID==4014830),]
season<-season[!(season$gameID==4021185),]
season<-season[!(season$gameID==4032124),]
season<-season[!(season$gameID==4044036),]
```

```{r}
save(season,file="season.rda")
```

#6

```{r}
# Create a measure of runs

sum(grepl("RBI", season$play))
sum(grepl("scored", season$play))

# There are 13772-13070 plays in which runs were scored not accounted for just by grepl("RBI") because some are scored, unearned

#Show how many runs come from one play
twoRBIs<-sum(grepl("2[[:space:]]RBI[[:space:]]",season$play))
twoRBIp<-sum(grepl("2[[:space:]]RBI[[:punct:]]",season$play))
threeRBIs<-sum(grepl("3[[:space:]]RBI[[:space:]]",season$play))
threeRBIp<-sum(grepl("3[[:space:]]RBI[[:punct:]]",season$play))
fourRBIs<-sum(grepl("4[[:space:]]RBI[[:space:]]",season$play))
fourRBIp<-sum(grepl("4[[:space:]]RBI[[:punct:]]",season$play))
  
totalRBIs<-sum(grepl("[[:space:]]RBI[[:space:]]",season$play))+sum(grepl("[[:space:]]RBI[[:punct:]]",season$play))
totalRBIs


totalScoringPlays<-sum(grepl("[[:space:]]scored[[:space:]]",season$play))+sum(grepl("[[:space:]]scored[[:punct:]]",season$play))

miscRuns<-totalScoringPlays-totalRBIs
miscRuns


# How many runs occurred because of play

season$runs_from_play<-as.numeric(grepl("[[:space:]]scored[[:space:]]|[[:space:]]scored[[:punct:]]" , season$play))


table(season$runs_from_play)
season$runs_from_play[grepl("2[[:space:]]RBI[[:space:]]",season$play)]<-2
season$runs_from_play[grepl("2[[:space:]]RBI[[:punct:]]",season$play)]<-2
season$runs_from_play[grepl("3[[:space:]]RBI[[:space:]]",season$play)]<-3
season$runs_from_play[grepl("3[[:space:]]RBI[[:punct:]]",season$play)]<-3
season$runs_from_play[grepl("4[[:space:]]RBI[[:space:]]",season$play)]<-4
season$runs_from_play[grepl("4[[:space:]]RBI[[:punct:]]",season$play)]<-4

season$runs_from_play[grepl("[^0-9][[:space:]]RBI[[:space:]]",season$play)]<-1
season$runs_from_play[grepl("[^0-9][[:space:]]RBI[[:punct:]]",season$play)]<-1
table(season$runs_from_play)

```

#7

```{r}
games<-unique(season$gameID)
games<-unique(season$gameID)

game<-season[season$gameID==games[1],]
dim(game) 




innings<-unique(game$inningID)
# Look at plays for one inning

game$play[game$inningID==3]
game$play[game$inningID==3&game$runs_from_play==1]
game$runs_from_play

# Look at runs in one inning
game$runs_from_play[game$inningID==0]
game$runs_from_play[game$inningID==3]

# Total runs in inning
game$total_runs_in_inning<-NA
for(i in innings){
       game$total_runs_in_inning[game$inningID==i]<-cumsum(game$runs_from_play[game$inningID==i])
    }
# Create an initial indicator of top and bottom
game$top_bottom[game$total_outs_in_inning<4]<-"top"
game$top_bottom[game$total_outs_in_inning>3]<-"bottom"

# Create empty vector for Total outs before play
game$runs_before_play<-0

# Total runs before play in top of Inning
for(i in innings){
        n<-length(game$outs_before_play[game$inningID==i&game$top_bottom=="top"])
       game$runs_before_play[game$inningID==i&game$top_bottom=="top"][2:n]<-cumsum(game$runs_from_play[game$inningID==i&game$top_bottom=="top"][1:n-1])
       game$runs_before_play[game$inningID==i&game$top_bottom=="top"][1]<-0
    }
# Total outs before play in bottom of Inning
for(i in innings){
        n<-length(game$outs_before_play[game$inningID==i&game$top_bottom=="bottom"])
       game$runs_before_play[game$inningID==i&game$top_bottom=="bottom"][2:n]<-cumsum(game$runs_from_play[game$inningID==i&game$top_bottom=="bottom"][1:n-1])
       game$runs_before_play[game$inningID==i&game$top_bottom=="bottom"][1]<-0
    }



# Top of Inning
for(i in innings){
        n<-length(game$outs_before_play[game$inningID==i&game$top_bottom=="top"])
       game$runs_before_play[game$inningID==i&game$top_bottom=="top"][2:n]<-cumsum(game$runs_from_play[game$inningID==i&game$top_bottom=="top"][1:n-1])
       game$runs_before_play[game$inningID==i&game$top_bottom=="top"][1]<-0
    }
# Bottom of Inning
for(i in innings){
        n<-length(game$outs_before_play[game$inningID==i&game$top_bottom=="bottom"])
       game$runs_before_play[game$inningID==i&game$top_bottom=="bottom"][2:n]<-cumsum(game$runs_from_play[game$inningID==i&game$top_bottom=="bottom"][1:n-1])
       game$runs_before_play[game$inningID==i&game$top_bottom=="bottom"][1]<-0
    }



# Manually inseR to make sure things look right

game[game$inningID==0,c("play","top_bottom","runs_from_play","runs_before_play","total_runs_in_inning")]

game[game$inningID==1,c("play","top_bottom","runs_from_play","runs_before_play","total_runs_in_inning")]

game[game$inningID==2,c("play","top_bottom","runs_from_play","runs_before_play","total_runs_in_inning")]


game[game$inningID==3,c("play","top_bottom","runs_from_play","runs_before_play","total_runs_in_inning")]

game[game$inningID==4,c("play","top_bottom","runs_from_play","runs_before_play","total_runs_in_inning")]


```

#8

```{r}

games<-unique(season$gameID)
#games<-sample(games,100)
# Total runs in inning
season$total_runs_in_inning<-NA
for(k in games){
    innings<-unique(season$inningID[season$gameID==k])
for(i in innings){
       season$total_runs_in_inning[season$inningID==i&season$gameID==k
]<-cumsum(season$runs_from_play[season$inningID==i&season$gameID==k
])
}
}




# Total runs before play
season$runs_before_play<-0

# Top of Inning
for(k in games){
        innings<-unique(season$inningID[season$gameID==k])
for(i in innings){
        n<-length(season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"])
        if(n==1){
            season$runs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][1]<-0
        }else{
       season$runs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][2:n]<-cumsum(season$runs_from_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][1:n-1])
       season$runs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][1]<-0
    }}}
# Bottom of Inning
for(k in games){
        innings<-unique(season$inningID[season$gameID==k])
for(i in innings){
        n<-length(season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"])
        if(n==1){
            season$runs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][1]<-0
        }else{
       season$runs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][2:n]<-cumsum(season$runs_from_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][1:n-1])
       season$runs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][1]<-0
    }}}





# Check
hist(season$total_runs_in_inning)
summary(season$total_runs_in_inning)
```



```{r}

save(season,file="season.rda")
```

#9

```{r}

#Creating Indicators for baserunners 


season$firstbase<-NA
season$firstbase[grepl("[[:space:]]singled",season$play)]<-1
season$firstbase[grepl("[[:space:]]walked",season$play)]<-1
season$firstbase[grepl("[[:space:]]reached[[:space:]]on[[:space:]]an[[:space:]]error",season$play)]<-1
season$firstbase[grepl("[[:space:]]hit[[:space:]]by[[:space:]]pitch",season$play)]<-1
season$firstbase[grepl("[[:space:]]catcher's[[:space:]]interference",season$play)]<-1
season$firstbase[grepl("[[:space:]]reached[[:space:]]first[[:space:]]on[[:space:]]a[[:space:]]passed[[:space:]]ball", season$play)]<-1
season$firstbase[grepl("[[:space:]]advanced[[:space:]]to[[:space:]]first",season$play)]<-1
season$firstbase[grepl("[[:space:]]out[[:space:]]at[[:space:]]first",season$play)]<-NA
season$firstbase[grepl("[[:space:]]stole[[:space:]]second",season$play)]<-NA
season$firstbase[grepl("[[:space:]]homered",season$play)]<-0
season$firstbase[grepl("[[:space:]]doubled",season$play)]<-NA
season$firstbase[grepl("[[:space:]]reached[[:space:]]on[[:space:]]a[[:space:]]fielder's[[:space:]]choice", season$play)]<-1
season$firstbase[grepl("advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]the[[:space:]]throw", season$play)]<-NA
season$firstbase[grepl("singled[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)]<-NA
season$firstbase[grepl("base[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)]<-NA
season$firstbase[grepl("field[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)]<-NA
season$firstbase[grepl("center[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)]<-NA
season$firstbase[grepl("middle[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)]<-NA
season$firstbase[grepl("side[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)]<-NA
season$firstbase[grepl("choice[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)]<-NA
season$firstbase[grepl("error[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)]<-NA
season$firstbase[grepl("by[[:space:]][[:alpha:]][[:alpha:]][[:space:]]advanced[[:space:]]to[[:space:]]second", season$play)]<-NA
season$firstbase[grepl("by[[:space:]][[:digit:]][[:alpha:]][[:space:]]advanced[[:space:]]to[[:space:]]second", season$play)]<-NA
season$firstbase[grepl("by[[:space:]][[:alpha:]][[:space:]]advanced[[:space:]]to[[:space:]]second", season$play)]<-NA



season$secondbase<-NA
season$secondbase[grepl("[[:space:]]advanced[[:space:]]to[[:space:]]second",season$play)]<-1
season$secondbase[grepl("[[:space:]]doubled",season$play)]<-1
season$secondbase[grepl("[[:space:]]out[[:space:]]at[[:space:]]second",season$play)]<-NA
season$secondbase[grepl("[[:space:]]stole[[:space:]]third",season$play)]<-NA
season$secondbase[grepl("[[:space:]]homered",season$play)]<-0
season$secondbase[grepl("[[:space:]]tripled",season$play)]<-NA
season$secondbase[grepl("placed[[:space:]]on[[:space:]]second",season$play)]<-1
season$secondbase[grepl("[[:space:]]stole[[:space:]]second[[:space:]][^a]",season$play)]<-1
season$secondbase[grepl("[[:space:]]stole[[:space:]]second[^.[:space:]]",season$play)]<-1


season$thirdbase<-NA
season$thirdbase[grepl("[[:space:]]advanced[[:space:]]to[[:space:]]third",season$play)]<-1
season$thirdbase[grepl("[[:space:]]tripled",season$play)]<-1
season$thirdbase[grepl("[[:space:]]out[[:space:]]at[[:space:]]third",season$play)]<-NA
season$thirdbase[grepl("[[:space:]]homered",season$play)]<-0
season$thirdbase[grepl("scored[[:space:]]on[[:space:]]a[[:space:]]wild[[:space:]]pitch",season$play)]<-0
season$thirdbase[grepl("scored[[:space:]]on[[:space:]]an[[:space:]]illegal[[:space:]]pitch",season$play)]<-0
season$thirdbase[grepl("scored[[:space:]]on[[:space:]]a[[:space:]]passed[[:space:]]ball",season$play)]<-0
season$thirdbase[grepl("[[:space:]]stole[[:space:]]second[^.[:space:]]",season$play)]<-1
season$thirdbase[grepl("[[:space:]]stole[[:space:]]second[[:space:]][^a]",season$play)]<-1



#Special Conditions


season$firstbase[grepl("[[:space:]]singled",season$play)&is.na(season$secondbase)&is.na(season$thirdbase)]<-NA
season$firstbase[grepl("[[:space:]]singled",season$play)&season$secondbase==1&is.na(season$thirdbase)]<-NA
season$firstbase[grepl("[[:space:]]singled",season$play)&season$secondbase==1&is.na(season$thirdbase)]<-NA

season$firstbase[grepl("[[:space:]]walked",season$play)&is.na(season$secondbase)&is.na(season$thirdbase)]<-NA

season$firstbase[grepl("[[:space:]]walked",season$play)&season$secondbase==1&is.na(season$thirdbase)]<-NA

season$firstbase[grepl("[[:space:]]reached[[:space:]]on[[:space:]]an[[:space:]]error[[:space:]]",season$play)&is.na(season$secondbase)&is.na(season$thirdbase)]<-NA

season$firstbase[grepl("[[:space:]]reached[[:space:]]on[[:space:]]an[[:space:]]error[[:space:]]",season$play)&season$secondbase==1&is.na(season$thirdbase)]<-NA

season$firstbase[grepl("[[:space:]]hit[[:space:]]by[[:space:]]pitch",season$play)&is.na(season$secondbase)&is.na(season$thirdbase)]<-NA
season$firstbase[grepl("[[:space:]]hit[[:space:]]by[[:space:]]pitch",season$play)&season$secondbase==1&is.na(season$thirdbase)]<-NA

season$firstbase[grepl("[[:space:]]catcher's[[:space:]]interference",season$play)&is.na(season$secondbase)&is.na(season$thirdbase)]<-NA
season$firstbase[grepl("[[:space:]]catcher's[[:space:]]interference",season$play)&season$secondbase==1&is.na(season$thirdbase)]<-NA

season$firstbase[grepl("[[:space:]]reached[[:space:]]first[[:space:]]on[[:space:]]a[[:space:]]passed[[:space:]]ball",season$play)&is.na(season$secondbase)&is.na(season$thirdbase)]<-NA



season$secondbase[grepl("[[:space:]]stole[[:space:]]second[.]",season$play)]<-NA

#Indicators for Special Conditions

season$temp<-0

season$temp[grepl("[[:space:]]singled",season$play)&is.na(season$secondbase)&is.na(season$thirdbase)]<-1



season$temp[grepl("[[:space:]]walked",season$play)&is.na(season$secondbase)&is.na(season$thirdbase)]<-1



season$temp[grepl("[[:space:]]reached[[:space:]]on[[:space:]]an[[:space:]]error[[:space:]]",season$play)&is.na(season$secondbase)&is.na(season$thirdbase)]<-1



season$temp[grepl("[[:space:]]hit[[:space:]]by[[:space:]]pitch",season$play)&is.na(season$secondbase)&is.na(season$thirdbase)]<-1


season$temp[grepl("[[:space:]]catcher's[[:space:]]interference",season$play)&is.na(season$secondbase)&is.na(season$thirdbase)]<-1


season$temp[grepl("[[:space:]]reached[[:space:]]first[[:space:]]on[[:space:]]a[[:space:]]passed[[:space:]]ball",season$play)&is.na(season$secondbase)&is.na(season$thirdbase)]<-1



season$temp[grepl("[[:space:]]stole[[:space:]]second[.]",season$play)]<-2

season$temp[grepl("[[:space:]]stole[[:space:]]third[.]",season$play)]<-3

season$temp[grepl("[[:space:]]singled",season$play)&season$secondbase==1&is.na(season$thirdbase)]<-4

season$temp[grepl("[[:space:]]catcher's[[:space:]]interference",season$play)&season$secondbase==1&is.na(season$thirdbase)]<-4

season$temp[grepl("[[:space:]]hit[[:space:]]by[[:space:]]pitch",season$play)&season$secondbase==1&is.na(season$thirdbase)]<-4

season$temp[grepl("[[:space:]]reached[[:space:]]on[[:space:]]an[[:space:]]error[[:space:]]",season$play)&season$secondbase==1&is.na(season$thirdbase)]<-4

season$temp[grepl("[[:space:]]walked",season$play)&season$secondbase==1&is.na(season$thirdbase)]<-4

season$temp[grepl("advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]the[[:space:]]throw", season$play)&is.na(season$thirdbase)]<-5
season$temp[grepl("singled[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)&is.na(season$thirdbase)]<-5
season$temp[grepl("base[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)&is.na(season$thirdbase)]<-5
season$temp[grepl("field[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)&is.na(season$thirdbase)]<-5
season$temp[grepl("center[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)&is.na(season$thirdbase)]<-5
season$temp[grepl("middle[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)&is.na(season$thirdbase)]<-5
season$temp[grepl("side[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)&is.na(season$thirdbase)]<-5
season$temp[grepl("choice[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)&is.na(season$thirdbase)]<-5
season$temp[grepl("error[[:space:]]advanced[[:space:]]to[[:space:]]second[[:space:]]on[[:space:]]an[[:space:]]error", season$play)&is.na(season$thirdbase)]<-5
season$temp[grepl("by[[:space:]][[:alpha:]][[:alpha:]][[:space:]]advanced[[:space:]]to[[:space:]]second", season$play)]<-5
season$temp[grepl("by[[:space:]][[:digit:]][[:alpha:]][[:space:]]advanced[[:space:]]to[[:space:]]second", season$play)&is.na(season$thirdbase)]<-5
season$temp[grepl("by[[:space:]][[:alpha:]][[:space:]]advanced[[:space:]]to[[:space:]]second", season$play)&is.na(season$thirdbase)]<-5
season$temp[grepl("caught[[:space:]]stealing", season$play)]<-6



season$base_state_after<-NA









#Nobody On


season$base_state_after[season$firstbase==0&season$secondbase==0&season$thirdbase==0&season$outs_before_play+season$outs_from_play==0]<-"Nobody on, No Outs"
season$base_state_after[season$firstbase==0&season$secondbase==0&season$thirdbase==0&season$outs_before_play+season$outs_from_play==1]<-"Nobody on, One out"
season$base_state_after[season$firstbase==0&season$secondbase==0&season$thirdbase==0&season$outs_before_play+season$outs_from_play==2]<-"Nobody on, Two outs"


season$base_state_after[is.na(season$firstbase)&is.na(season$secondbase)&season$thirdbase==0&season$outs_before_play+season$outs_from_play==0]<-"Nobody on, No Outs"
season$base_state_after[is.na(season$firstbase)&is.na(season$secondbase)&season$thirdbase==0&season$outs_before_play+season$outs_from_play==1]<-"Nobody on, One out"
season$base_state_after[is.na(season$firstbase)&is.na(season$secondbase)&season$thirdbase==0&season$outs_before_play+season$outs_from_play==2]<-"Nobody on, Two outs"








#Runners on First
season$base_state_after[season$firstbase==1&is.na(season$secondbase)&is.na(season$thirdbase)&season$outs_before_play+season$outs_from_play==0]<-"Runner on 1st, No outs"

season$base_state_after[season$firstbase==1&is.na(season$secondbase)&season$thirdbase==0&season$outs_before_play+season$outs_from_play==0]<-"Runner on 1st, No outs"

season$base_state_after[season$firstbase==1&is.na(season$secondbase)&is.na(season$thirdbase)&season$outs_before_play+season$outs_from_play==1]<-"Runner on 1st, One out"

season$base_state_after[season$firstbase==1&is.na(season$secondbase)&season$thirdbase==0&season$outs_before_play+season$outs_from_play==1]<-"Runner on 1st, One out"

season$base_state_after[season$firstbase==1&is.na(season$secondbase)&is.na(season$thirdbase)&season$outs_before_play+season$outs_from_play==2]<-"Runner on 1st, Two outs"

season$base_state_after[season$firstbase==1&is.na(season$secondbase)&season$thirdbase==0&season$outs_before_play+season$outs_from_play==2]<-"Runner on 1st, Two outs"




##Runner on 2nd

season$base_state_after[is.na(season$firstbase)&season$secondbase==1&is.na(season$thirdbase)&season$outs_before_play+season$outs_from_play==0]<-"Runner on 2nd, No outs"

season$base_state_after[is.na(season$firstbase)&season$secondbase==1&season$thirdbase==0&season$outs_before_play+season$outs_from_play==0]<-"Runner on 2nd, No outs"


season$base_state_after[is.na(season$firstbase)&season$secondbase==1&is.na(season$thirdbase)&season$outs_before_play+season$outs_from_play==1]<-"Runner on 2nd, One out"

season$base_state_after[is.na(season$firstbase)&season$secondbase==1&season$thirdbase==0&season$outs_before_play+season$outs_from_play==1]<-"Runner on 2nd, One out"

season$base_state_after[is.na(season$firstbase)&season$secondbase==1&is.na(season$thirdbase)&season$outs_before_play+season$outs_from_play==2]<-"Runner on 2nd, Two outs"

season$base_state_after[is.na(season$firstbase)&season$secondbase==1&season$thirdbase==0&season$outs_before_play+season$outs_from_play==2]<-"Runner on 2nd, Two outs"

#Runner on third


season$base_state_after[is.na(season$firstbase)&is.na(season$secondbase)&season$thirdbase==1&season$outs_before_play+season$outs_from_play==0]<-"Runner on 3rd, No outs"
season$base_state_after[is.na(season$firstbase)&is.na(season$secondbase)&season$thirdbase==1&season$outs_before_play+season$outs_from_play==1]<-"Runner on 3rd, One out"
season$base_state_after[is.na(season$firstbase)&is.na(season$secondbase)&season$thirdbase==1&season$outs_before_play+season$outs_from_play==2]<-"Runner on 3rd, Two outs"

#Runners on 1st and 2nd

season$base_state_after[season$firstbase==1&season$secondbase==1&is.na(season$thirdbase)&season$outs_before_play+season$outs_from_play==0]<-"Runners on 1st and 2nd, No outs"

season$base_state_after[season$firstbase==1&season$secondbase==1&season$thirdbase==0&season$outs_before_play+season$outs_from_play==0]<-"Runners on 1st and 2nd, No outs"


season$base_state_after[season$firstbase==1&season$secondbase==1&is.na(season$thirdbase)&season$outs_before_play+season$outs_from_play==1]<-"Runners on 1st and 2nd, One out"

season$base_state_after[season$firstbase==1&season$secondbase==1&season$thirdbase==0&season$outs_before_play+season$outs_from_play==1]<-"Runners on 1st and 2nd, One out"

season$base_state_after[season$firstbase==1&season$secondbase==1&is.na(season$thirdbase)&season$outs_before_play+season$outs_from_play==2]<-"Runners on 1st and 2nd, Two outs"

season$base_state_after[season$firstbase==1&season$secondbase==1&season$thirdbase==0&season$outs_before_play+season$outs_from_play==2]<-"Runners on 1st and 2nd, Two outs"

#Runners on 2nd and 3rd

season$base_state_after[is.na(season$firstbase)&season$secondbase==1&season$thirdbase==1&season$outs_before_play+season$outs_from_play==0]<-"Runners on 2nd and 3rd, No outs"
season$base_state_after[is.na(season$firstbase)&season$secondbase==1&season$thirdbase==1&season$outs_before_play+season$outs_from_play==1]<-"Runners on 2nd and 3rd, One out"
season$base_state_after[is.na(season$firstbase)&season$secondbase==1&season$thirdbase==1&season$outs_before_play+season$outs_from_play==2]<-"Runners on 2nd and 3rd, Two outs"


#Runners on 1st and 3rd

season$base_state_after[season$firstbase==1&is.na(season$secondbase)&season$thirdbase==1&season$outs_before_play+season$outs_from_play==0]<-"Runners on 1st and 3rd, No outs"
season$base_state_after[season$firstbase==1&is.na(season$secondbase)&season$thirdbase==1&season$outs_before_play+season$outs_from_play==1]<-"Runners on 1st and 3rd, One out"
season$base_state_after[season$firstbase==1&is.na(season$secondbase)&season$thirdbase==1&season$outs_before_play+season$outs_from_play==2]<-"Runners on 1st and 3rd, Two outs"

#Bases Loaded

season$base_state_after[season$firstbase==1&season$secondbase==1&season$thirdbase==1&season$outs_before_play+season$outs_from_play==0]<-"Bases Loaded, No outs"
season$base_state_after[season$firstbase==1&season$secondbase==1&season$thirdbase==1&season$outs_before_play+season$outs_from_play==1]<-"Bases Loaded, One out"
season$base_state_after[season$firstbase==1&season$secondbase==1&season$thirdbase==1&season$outs_before_play+season$outs_from_play==2]<-"Bases Loaded, Two outs"


season$base_state_after[season$temp==1]<-"placeholder"
season$base_state_after[season$temp==2]<-"placeholder"
season$base_state_after[season$temp==3]<-"placeholder"
season$base_state_after[season$temp==4]<-"placeholder"

```



#10

```{r}

#Setting the table for the base_State_before, including starting each inning with "Nobody on, No Outs"

season$base_state_before<-NA




#Top of inning
for(k in games){
       innings<-unique(season$inningID[season$gameID==k])
for(i in innings){

n<-length(season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="top"])
       if(n==1){
           season$base_state_before[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][1]<-"Nobody on, No Outs"
       }else{
      season$base_state_before[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][2:n]<-(season$base_state_after[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][1:n-1])
      season$base_state_before[season$inningID==i&season$gameID==k
&season$top_bottom=="top"][1]<-"Nobody on, No Outs"
       }}}
# Bottom of Inning
for(k in games){
        innings<-unique(season$inningID[season$gameID==k])
for(i in innings){
        n<-length(season$outs_before_play[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"])
        if(n==1){
            season$base_state_before[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][1]<-"Nobody on, No Outs"
        }else{
       season$base_state_before[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][2:n]<-(season$base_state_after[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][1:n-1])
       season$base_state_before[season$inningID==i&season$gameID==k
&season$top_bottom=="bottom"][1]<-"Nobody on, No Outs"
    }}}



```

#11
```{r}

season$base_state_before[is.na(season$base_state_before)]<-"placeholder"

#Nobody On
for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, No Outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}


#Runner on 1st

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

#Runner on 2nd
for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}

#Runner on 3rd
for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, Two outs"}
}

#Runners on 1st and 2nd

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}
#Runners on 1st and 3rd

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, Two outs"}
}

#Runners on 2nd and 3rd

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, Two outs"}
}
#Bases Loaded

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Bases Loaded, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Bases Loaded, Two outs"}
}




#Condition 1 — solo reach first

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, No Outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 3rd, Two outs"}
}

##Subset

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==1){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==1){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==1){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

##4

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

##6

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Nobody on, No Outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, No Outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, No Outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}

# Condition 2 — the Stolen Base

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, Two outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}



#Condition 3 — stolen third

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, No outs"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, Two outs"}
}






```

#11.2
```{r}

season$base_state_before[is.na(season$base_state_before)]<-"placeholder"



#Nobody On
for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, No Outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}


#Runner on 1st

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

#Runner on 2nd
for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}

#Runner on 3rd
for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, Two outs"}
}

#Runners on 1st and 2nd

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}
#Runners on 1st and 3rd

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, Two outs"}
}

#Runners on 2nd and 3rd

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, Two outs"}
}
#Bases Loaded

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Bases Loaded, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Bases Loaded, Two outs"}
}




#Condition 1 — solo reach first

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, No Outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 3rd, Two outs"}
}

##Subset

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==1){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==1){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==1){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

##4

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

##6

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Nobody on, No Outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, No Outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, No Outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}

# Condition 2 — the Stolen Base

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, Two outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}



#Condition 3 — stolen third

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, No outs"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, Two outs"}
}






```

#11.3
```{r}

season$base_state_before[is.na(season$base_state_before)]<-"placeholder"



#Nobody On
for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, No Outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}


#Runner on 1st

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

#Runner on 2nd
for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}

#Runner on 3rd
for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, Two outs"}
}

#Runners on 1st and 2nd

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}
#Runners on 1st and 3rd

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, Two outs"}
}

#Runners on 2nd and 3rd

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, Two outs"}
}
#Bases Loaded

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Bases Loaded, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Bases Loaded, Two outs"}
}




#Condition 1 — solo reach first

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, No Outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 3rd, Two outs"}
}

##Subset

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==1){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==1){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==1){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

##4

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

##6

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Nobody on, No Outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, No Outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, No Outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}

# Condition 2 — the Stolen Base

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, Two outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}



#Condition 3 — stolen third

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, No outs"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, Two outs"}
}






```

#11.4
```{r}

season$base_state_before[is.na(season$base_state_before)]<-"placeholder"



#Nobody On
for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, No Outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}


#Runner on 1st

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

#Runner on 2nd
for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}

#Runner on 3rd
for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, Two outs"}
}

#Runners on 1st and 2nd

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}
#Runners on 1st and 3rd

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, Two outs"}
}

#Runners on 2nd and 3rd

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, Two outs"}
}
#Bases Loaded

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, No outs"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Bases Loaded, One out"}
}

for(i in 3:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, One out"&season$outs_from_play[i-1]==1&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Bases Loaded, Two outs"}
}




#Condition 1 — solo reach first

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, No Outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Nobody on, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Runners on 1st and 3rd, Two outs"}
}

##Subset

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==1){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==1){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==1){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 2nd and 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, No outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, One out"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 3rd, Two outs"&season$temp[i-1]==1&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 1st, Two outs"}
}

##4

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==0){
            season$base_state_before[i]<-"Bases Loaded, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, No outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runners on 1st and 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, One out"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runners on 1st and 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Bases Loaded, Two outs"&season$temp[i-1]==4&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]==2){
            season$base_state_before[i]<-"Runners on 1st and 2nd, Two outs"}
}

##6

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Nobody on, No Outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, No Outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, No Outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Nobody on, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, No outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, Two outs"&season$temp[i-1]==6&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}

# Condition 2 — the Stolen Base

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, No outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, One out"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 1st, Two outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 2nd and 3rd, Two outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, No outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 2nd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, One out"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 2nd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 3rd, Two outs"&season$temp[i-1]==2&season$base_state_before[i]=="placeholder"&season$runs_from_play[i-1]!=0){
            season$base_state_before[i]<-"Runner on 2nd, Two outs"}
}



#Condition 3 — stolen third

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, No outs"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runner on 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runner on 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, No outs"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, No outs"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, One out"}
}

for(i in 2:length(season$outs_from_play)){
       if(season$base_state_before[i-1]=="Runners on 1st and 2nd, One out"&season$temp[i-1]==3&season$base_state_before[i]=="placeholder"){
            season$base_state_before[i]<-"Runners on 1st and 3rd, Two outs"}
}


table(season$base_state_before)



```




```{r}
save(season,file="season.rda")


```



#12

```{r}

#Max runs per half of an inning

library(dplyr)
runs_df<-season %>% dplyr::group_by(gameID,inningID,top_bottom)%>%
  dplyr::summarize(
      runs=max(runs_before_play,na.rm=T)
  )

```


#13


```{r}

#"Nobody on, No Outs"

library(dplyr)
nooneon_noout_runs_df<-season[season$base_state_before=="Nobody on, No Outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=eT))

nooneon_noout_runs_df<- merge(nooneon_noout_runs_df,runs_df,all=TRUE,sort=FALSE)



nooneon_noout_runs_df$runsReal<-nooneon_noout_runs_df$runs-nooneon_noout_runs_df$runsbefore

summary(nooneon_noout_runs_df$runsReal)
length(nooneon_noout_runs_df$runsReal)
sum(nooneon_noout_runs_df$runsReal)/sqrt(length(which(season$base_state_before=="Nobody on, No Outs")))
hist(nooneon_noout_runs_df$runsReal)

standarderror1<-sd(nooneon_noout_runs_df$runsReal)/sqrt(length(which(season$base_state_before=="Nobody on, No Outs")))
standarderror1
#95% confidence intervals of the mean
nooneon_noout_runs_df$ll<-mean(nooneon_noout_runs_df$runsReal)-1.96*standarderror1
nooneon_noout_runs_df$ul<-mean(nooneon_noout_runs_df$runsReal)+1.96*standarderror1

nooneon_noout_runs_df$ul[1]
nooneon_noout_runs_df$ll[1]


(mean(nooneon_noout_runs_df$runsReal,na.rm=T)-.555)/(standarderror1)


```

# 14

```{r}

#"Nobody on, One out"

library(dplyr)

nooneon_oneout_runs_df<-season[season$base_state_before=="Nobody on, One out",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
nooneon_oneout_runs_df<- merge(nooneon_oneout_runs_df,runs_df,all=TRUE,sort=FALSE)

nooneon_oneout_runs_df$runsReal<-nooneon_oneout_runs_df$runs-nooneon_oneout_runs_df$runsbefore

mean(nooneon_oneout_runs_df$runsReal,na.rm=T)
table(nooneon_oneout_runs_df$runsReal)
sum(nooneon_oneout_runs_df$runsReal)/length(nooneon_oneout_runs_df$runsReal)
hist(nooneon_oneout_runs_df$runsReal)

standarderror2<-sd(nooneon_oneout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Nobody on, One out")))
standarderror2
#95% confidence intervals of the mean
nooneon_oneout_runs_df$ll<-mean(nooneon_oneout_runs_df$runsReal,na.rm=T)-1.96*standarderror2
nooneon_oneout_runs_df$ul<-mean(nooneon_oneout_runs_df$runsReal,na.rm=T)+1.96*standarderror2

nooneon_oneout_runs_df$ul[1]
nooneon_oneout_runs_df$ll[1]

mean(nooneon_oneout_runs_df$runsReal,na.r=T)-.297/(standarderror2)


```

#15


```{r}
#"Nobody on, Two outs"
library(dplyr)

nooneon_twoout_runs_df<-season[season$base_state_before=="Nobody on, Two outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
nooneon_twoout_runs_df<- merge(nooneon_twoout_runs_df,runs_df,all=TRUE,sort=FALSE)



nooneon_twoout_runs_df$runsReal<-nooneon_twoout_runs_df$runs-nooneon_twoout_runs_df$runsbefore



mean(nooneon_twoout_runs_df$runsReal,na.rm=T)
table(nooneon_twoout_runs_df$runsReal)
sum(nooneon_twoout_runs_df$runsReal)/length(nooneon_twoout_runs_df$runsReal)
hist(nooneon_twoout_runs_df$runsReal)


standarderror3<-sd(nooneon_twoout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Nobody on, Two outs")))
standarderror3
#95% confidence intervals of the mean
nooneon_twoout_runs_df$ll<-mean(nooneon_twoout_runs_df$runsReal,na.rm=T)-1.96*standarderror3
nooneon_twoout_runs_df$ul<-mean(nooneon_twoout_runs_df$runsReal,na.rm=T)+1.96*standarderror3

nooneon_twoout_runs_df$ul[1]
nooneon_twoout_runs_df$ll[1]

mean(nooneon_twoout_runs_df$runsReal,na.r=T)-.117/(standarderror3)

```

#16

```{r}

library(dplyr)

one_noout_runs_df<-season[season$base_state_before=="Runner on 1st, No outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
one_noout_runs_df<- merge(one_noout_runs_df,runs_df,all=TRUE,sort=FALSE)



one_noout_runs_df$runsReal<-one_noout_runs_df$runs-one_noout_runs_df$runsbefore



mean(one_noout_runs_df$runsReal,na.rm=T)
table(one_noout_runs_df$runsReal)
sum(one_noout_runs_df$runsReal)/length(one_noout_runs_df$runsReal)
hist(one_noout_runs_df$runsReal)

   
   



standarderror4<-sd(one_noout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runner on 1st, No outs")))
standarderror4
#95% confidence intervals of the mean
one_noout_runs_df$ll<-mean(one_noout_runs_df$runsReal,na.rm=T)-1.96*standarderror4
one_noout_runs_df$ul<-mean(one_noout_runs_df$runsReal,na.rm=T)+1.96*standarderror4

one_noout_runs_df$ul[1]
one_noout_runs_df$ll[1]

   

   
   

mean(one_noout_runs_df$runsReal,na.r=T)-.117/(standarderror4)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB

```

#17

```{r}

library(dplyr)

one_oneout_runs_df<-season[season$base_state_before=="Runner on 1st, One out",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
one_oneout_runs_df<- merge(one_oneout_runs_df,runs_df,all=TRUE,sort=FALSE)



one_oneout_runs_df$runsReal<-one_oneout_runs_df$runs-one_oneout_runs_df$runsbefore



mean(one_oneout_runs_df$runsReal,na.rm=T)
table(one_oneout_runs_df$runsReal)
sum(one_oneout_runs_df$runsReal)/length(one_oneout_runs_df$runsReal)
hist(one_oneout_runs_df$runsReal)

   
   



standarderror5<-sd(one_oneout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runner on 1st, One out")))
standarderror5
#95% confidence intervals of the mean
one_oneout_runs_df$ll<-mean(one_oneout_runs_df$runsReal,na.rm=T)-1.96*standarderror5
one_oneout_runs_df$ul<-mean(one_oneout_runs_df$runsReal,na.rm=T)+1.96*standarderror5

one_oneout_runs_df$ul[1]
one_oneout_runs_df$ll[1]

   

   
   

mean(one_oneout_runs_df$runsReal,na.r=T)-.573/(standarderror5)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```


#18

```{r}

library(dplyr)

one_twoouts_runs_df<-season[season$base_state_before=="Runner on 1st, Two outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
one_twoouts_runs_df<- merge(one_twoouts_runs_df,runs_df,all=TRUE,sort=FALSE)



one_twoouts_runs_df$runsReal<-one_twoouts_runs_df$runs-one_twoouts_runs_df$runsbefore



mean(one_twoouts_runs_df$runsReal,na.rm=T)
table(one_twoouts_runs_df$runsReal)
sum(one_twoouts_runs_df$runsReal)/length(one_twoouts_runs_df$runsReal)
hist(one_twoouts_runs_df$runsReal)

   
   



standarderror6<-sd(one_twoouts_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runner on 1st, Two outs")))
standarderror6
#95% confidence intervals of the mean
one_twoouts_runs_df$ll<-mean(one_twoouts_runs_df$runsReal,na.rm=T)-1.96*standarderror6
one_twoouts_runs_df$ul<-mean(one_twoouts_runs_df$runsReal,na.rm=T)+1.96*standarderror6

one_twoouts_runs_df$ul[1]
one_twoouts_runs_df$ll[1]

   

   
   

mean(one_twoouts_runs_df$runsReal,na.r=T)-.251/(standarderror6)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```

#19

```{r}

library(dplyr)

two_noout_runs_df<-season[season$base_state_before=="Runner on 2nd, No outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
two_noout_runs_df<- merge(two_noout_runs_df,runs_df,all=TRUE,sort=FALSE)



two_noout_runs_df$runsReal<-two_noout_runs_df$runs-two_noout_runs_df$runsbefore



mean(two_noout_runs_df$runsReal,na.rm=T)
table(two_noout_runs_df$runsReal)
sum(two_noout_runs_df$runsReal)/length(two_noout_runs_df$runsReal)
hist(two_noout_runs_df$runsReal)

   
   



standarderror7<-sd(two_noout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runner on 2nd, No outs")))
standarderror7
#95% confidence intervals of the mean
two_noout_runs_df$ll<-mean(two_noout_runs_df$runsReal,na.rm=T)-1.96*standarderror7
two_noout_runs_df$ul<-mean(two_noout_runs_df$runsReal,na.rm=T)+1.96*standarderror7

two_noout_runs_df$ul[1]
two_noout_runs_df$ll[1]

   

   
   

mean(two_noout_runs_df$runsReal,na.r=T)-.251/(standarderror7)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```

#20

```{r}

library(dplyr)

two_oneout_runs_df<-season[season$base_state_before=="Runner on 2nd, One out",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
two_oneout_runs_df<- merge(two_oneout_runs_df,runs_df,all=TRUE,sort=FALSE)



two_oneout_runs_df$runsReal<-two_oneout_runs_df$runs-two_oneout_runs_df$runsbefore



mean(two_oneout_runs_df$runsReal,na.rm=T)
table(two_oneout_runs_df$runsReal)
sum(two_oneout_runs_df$runsReal)/length(two_oneout_runs_df$runsReal)
hist(two_oneout_runs_df$runsReal)

   
   



standarderror8<-sd(two_oneout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runner on 2nd, One out")))
standarderror8
#95% confidence intervals of the mean
two_oneout_runs_df$ll<-mean(two_oneout_runs_df$runsReal,na.rm=T)-1.96*standarderror8
two_oneout_runs_df$ul<-mean(two_oneout_runs_df$runsReal,na.rm=T)+1.96*standarderror8

two_oneout_runs_df$ul[1]
two_oneout_runs_df$ll[1]

   

   
   

mean(two_oneout_runs_df$runsReal,na.r=T)-.251/(standarderror8)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```


#21

```{r}

library(dplyr)

two_twoout_runs_df<-season[season$base_state_before=="Runner on 2nd, Two outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
two_twoout_runs_df<- merge(two_twoout_runs_df,runs_df,all=TRUE,sort=FALSE)



two_twoout_runs_df$runsReal<-two_twoout_runs_df$runs-two_twoout_runs_df$runsbefore



mean(two_twoout_runs_df$runsReal,na.rm=T)
table(two_twoout_runs_df$runsReal)
sum(two_twoout_runs_df$runsReal)/length(two_twoout_runs_df$runsReal)
hist(two_twoout_runs_df$runsReal)

   
   



standarderror9<-sd(two_twoout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runner on 2nd, Two outs")))
standarderror9
#95% confidence intervals of the mean
two_twoout_runs_df$ll<-mean(two_twoout_runs_df$runsReal,na.rm=T)-1.96*standarderror9
two_twoout_runs_df$ul<-mean(two_twoout_runs_df$runsReal,na.rm=T)+1.96*standarderror9

two_twoout_runs_df$ul[1]
two_twoout_runs_df$ll[1]

   

   
   

mean(two_twoout_runs_df$runsReal,na.r=T)-.251/(standarderror9)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```

#22

```{r}

library(dplyr)

three_noout_runs_df<-season[season$base_state_before=="Runner on 3rd, No outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
three_noout_runs_df<- merge(three_noout_runs_df,runs_df,all=TRUE,sort=FALSE)



three_noout_runs_df$runsReal<-three_noout_runs_df$runs-three_noout_runs_df$runsbefore



mean(three_noout_runs_df$runsReal,na.rm=T)
table(three_noout_runs_df$runsReal)
sum(three_noout_runs_df$runsReal)/length(three_noout_runs_df$runsReal)
hist(three_noout_runs_df$runsReal)

   
   



standarderror10<-sd(three_noout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runner on 3rd, No outs")))
standarderror10
#95% confidence intervals of the mean
three_noout_runs_df$ll<-mean(three_noout_runs_df$runsReal,na.rm=T)-1.96*standarderror10
three_noout_runs_df$ul<-mean(three_noout_runs_df$runsReal,na.rm=T)+1.96*standarderror10

three_noout_runs_df$ul[1]
three_noout_runs_df$ll[1]

   

   
   

mean(three_noout_runs_df$runsReal,na.r=T)-.251/(standarderror10)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```


#23

```{r}

library(dplyr)

three_oneout_runs_df<-season[season$base_state_before=="Runner on 3rd, One out",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
three_oneout_runs_df<- merge(three_oneout_runs_df,runs_df,all=TRUE,sort=FALSE)



three_oneout_runs_df$runsReal<-three_oneout_runs_df$runs-three_oneout_runs_df$runsbefore



mean(three_oneout_runs_df$runsReal,na.rm=T)
table(three_oneout_runs_df$runsReal)
sum(three_oneout_runs_df$runsReal)/length(three_oneout_runs_df$runsReal)

hist(three_oneout_runs_df$runsReal)

   
   



standarderror11<-sd(three_oneout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runner on 3rd, One out")))
standarderror11
#95% confidence intervals of the mean
three_oneout_runs_df$ll<-mean(three_oneout_runs_df$runsReal,na.rm=T)-1.96*standarderror11
three_oneout_runs_df$ul<-mean(three_oneout_runs_df$runsReal,na.rm=T)+1.96*standarderror11

three_oneout_runs_df$ul[1]
three_oneout_runs_df$ll[1]

   

   
   

mean(three_oneout_runs_df$runsReal,na.r=T)-.251/(standarderror11)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```


#24

```{r}

library(dplyr)

three_twoout_runs_df<-season[season$base_state_before=="Runner on 3rd, Two outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
three_twoout_runs_df<- merge(three_twoout_runs_df,runs_df,all=TRUE,sort=FALSE)



three_twoout_runs_df$runsReal<-three_twoout_runs_df$runs-three_twoout_runs_df$runsbefore



mean(three_twoout_runs_df$runsReal,na.rm=T)
table(three_twoout_runs_df$runsReal)
sum(three_twoout_runs_df$runsReal)/length(three_twoout_runs_df$runsReal)
hist(three_twoout_runs_df$runsReal)

   
   



standarderror12<-sd(three_twoout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runner on 3rd, Two outs")))
standarderror12
#95% confidence intervals of the mean
three_twoout_runs_df$ll<-mean(three_twoout_runs_df$runsReal,na.rm=T)-1.96*standarderror12
three_twoout_runs_df$ul<-mean(three_twoout_runs_df$runsReal,na.rm=T)+1.96*standarderror12

three_twoout_runs_df$ul[1]
three_twoout_runs_df$ll[1]

   

   
   

mean(three_twoout_runs_df$runsReal,na.r=T)-.251/(standarderror12)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```


#25

```{r}

library(dplyr)

onetwo_noout_runs_df<-season[season$base_state_before=="Runners on 1st and 2nd, No outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
onetwo_noout_runs_df<- merge(onetwo_noout_runs_df,runs_df,all=TRUE,sort=FALSE)



onetwo_noout_runs_df$runsReal<-onetwo_noout_runs_df$runs-onetwo_noout_runs_df$runsbefore



mean(onetwo_noout_runs_df$runsReal,na.rm=T)
table(onetwo_noout_runs_df$runsReal)
sum(onetwo_noout_runs_df$runsReal)/length(onetwo_noout_runs_df$runsReal)
hist(onetwo_noout_runs_df$runsReal)

   
   



standarderror13<-sd(onetwo_noout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runners on 1st and 2nd, No outs")))
standarderror13
#95% confidence intervals of the mean
onetwo_noout_runs_df$ll<-mean(onetwo_noout_runs_df$runsReal,na.rm=T)-1.96*standarderror13
onetwo_noout_runs_df$ul<-mean(onetwo_noout_runs_df$runsReal,na.rm=T)+1.96*standarderror13

onetwo_noout_runs_df$ul[1]
onetwo_noout_runs_df$ll[1]

   

   
   

mean(onetwo_noout_runs_df$runsReal,na.r=T)-.251/(standarderror13)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```


#26

```{r}

library(dplyr)

onetwo_oneout_runs_df<-season[season$base_state_before=="Runners on 1st and 2nd, One out",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
onetwo_oneout_runs_df<- merge(onetwo_oneout_runs_df,runs_df,all=TRUE,sort=FALSE)



onetwo_oneout_runs_df$runsReal<-onetwo_oneout_runs_df$runs-onetwo_oneout_runs_df$runsbefore



mean(onetwo_oneout_runs_df$runsReal,na.rm=T)
table(onetwo_oneout_runs_df$runsReal)
sum(onetwo_oneout_runs_df$runsReal)/length(onetwo_oneout_runs_df$runsReal)
hist(onetwo_oneout_runs_df$runsReal)

   
   



standarderror14<-sd(onetwo_oneout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runners on 1st and 2nd, One out")))
standarderror14
#95% confidence intervals of the mean
onetwo_oneout_runs_df$ll<-mean(onetwo_oneout_runs_df$runsReal,na.rm=T)-1.96*standarderror14
onetwo_oneout_runs_df$ul<-mean(onetwo_oneout_runs_df$runsReal,na.rm=T)+1.96*standarderror14

onetwo_oneout_runs_df$ul[1]
onetwo_oneout_runs_df$ll[1]

   

   
   

mean(onetwo_oneout_runs_df$runsReal,na.r=T)-.251/(standarderror14)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```

#27

```{r}

library(dplyr)

onetwo_twoouts_runs_df<-season[season$base_state_before=="Runners on 1st and 2nd, Two outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
onetwo_twoouts_runs_df<- merge(onetwo_twoouts_runs_df,runs_df,all=TRUE,sort=FALSE)



onetwo_twoouts_runs_df$runsReal<-onetwo_twoouts_runs_df$runs-onetwo_twoouts_runs_df$runsbefore



mean(onetwo_twoouts_runs_df$runsReal,na.rm=T)
table(onetwo_twoouts_runs_df$runsReal)
sum(onetwo_twoouts_runs_df$runsReal)/length(onetwo_twoouts_runs_df$runsReal)
hist(onetwo_twoouts_runs_df$runsReal)

   
   



standarderror15<-sd(onetwo_twoouts_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runners on 1st and 2nd, Two outs")))
standarderror15
#95% confidence intervals of the mean
onetwo_twoouts_runs_df$ll<-mean(onetwo_twoouts_runs_df$runsReal,na.rm=T)-1.96*standarderror15
onetwo_twoouts_runs_df$ul<-mean(onetwo_twoouts_runs_df$runsReal,na.rm=T)+1.96*standarderror15

onetwo_twoouts_runs_df$ul[1]
onetwo_twoouts_runs_df$ll[1]

   

   
   

mean(onetwo_twoouts_runs_df$runsReal,na.r=T)-.251/(standarderror15)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```


#28

```{r}

library(dplyr)

onethree_noout_runs_df<-season[season$base_state_before=="Runners on 1st and 3rd, No outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
onethree_noout_runs_df<- merge(onethree_noout_runs_df,runs_df,all=TRUE,sort=FALSE)



onethree_noout_runs_df$runsReal<-onethree_noout_runs_df$runs-onethree_noout_runs_df$runsbefore



mean(onethree_noout_runs_df$runsReal,na.rm=T)
table(onethree_noout_runs_df$runsReal)
sum(onethree_noout_runs_df$runsReal)/length(onethree_noout_runs_df$runsReal)
hist(onethree_noout_runs_df$runsReal)

   
   



standarderror16<-sd(onethree_noout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runners on 1st and 3rd, No outs")))
standarderror16
#95% confidence intervals of the mean
onethree_noout_runs_df$ll<-mean(onethree_noout_runs_df$runsReal,na.rm=T)-1.96*standarderror16
onethree_noout_runs_df$ul<-mean(onethree_noout_runs_df$runsReal,na.rm=T)+1.96*standarderror16

onethree_noout_runs_df$ul[1]
onethree_noout_runs_df$ll[1]

   

   
   

mean(onethree_noout_runs_df$runsReal,na.r=T)-.251/(standarderror16)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```


#29

```{r}

library(dplyr)

onethree_oneout_runs_df<-season[season$base_state_before=="Runners on 1st and 3rd, One out",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
onethree_oneout_runs_df<- merge(onethree_oneout_runs_df,runs_df,all=TRUE,sort=FALSE)



onethree_oneout_runs_df$runsReal<-onethree_oneout_runs_df$runs-onethree_oneout_runs_df$runsbefore



mean(onethree_oneout_runs_df$runsReal,na.rm=T)
table(onethree_oneout_runs_df$runsReal)
sum(onethree_oneout_runs_df$runsReal)/length(onethree_oneout_runs_df$runsReal)
hist(onethree_oneout_runs_df$runsReal)

   
   



standarderror17<-sd(onethree_oneout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runners on 1st and 3rd, One out")))
standarderror17
#95% confidence intervals of the mean
onethree_oneout_runs_df$ll<-mean(onethree_oneout_runs_df$runsReal,na.rm=T)-1.96*standarderror17
onethree_oneout_runs_df$ul<-mean(onethree_oneout_runs_df$runsReal,na.rm=T)+1.96*standarderror17

onethree_oneout_runs_df$ul[1]
onethree_oneout_runs_df$ll[1]

   

   
   

mean(onethree_oneout_runs_df$runsReal,na.r=T)-.251/(standarderror17)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```


#30

```{r}

library(dplyr)

onethree_twoouts_runs_df<-season[season$base_state_before=="Runners on 1st and 3rd, Two outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
onethree_twoouts_runs_df<- merge(onethree_twoouts_runs_df,runs_df,all=TRUE,sort=FALSE)



onethree_twoouts_runs_df$runsReal<-onethree_twoouts_runs_df$runs-onethree_twoouts_runs_df$runsbefore



mean(onethree_twoouts_runs_df$runsReal,na.rm=T)
table(onethree_twoouts_runs_df$runsReal)
sum(onethree_twoouts_runs_df$runsReal)/length(onethree_twoouts_runs_df$runsReal)
hist(onethree_twoouts_runs_df$runsReal)

   
   



standarderror18<-sd(onethree_twoouts_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runners on 1st and 3rd, Two outs")))
standarderror18
#95% confidence intervals of the mean
onethree_twoouts_runs_df$ll<-mean(onethree_twoouts_runs_df$runsReal,na.rm=T)-1.96*standarderror18
onethree_twoouts_runs_df$ul<-mean(onethree_twoouts_runs_df$runsReal,na.rm=T)+1.96*standarderror18

onethree_twoouts_runs_df$ul[1]
onethree_twoouts_runs_df$ll[1]

   

   
   

mean(onethree_twoouts_runs_df$runsReal,na.r=T)-.251/(standarderror18)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```

#31

```{r}

library(dplyr)

twothree_noout_runs_df<-season[season$base_state_before=="Runners on 2nd and 3rd, No outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
twothree_noout_runs_df<- merge(twothree_noout_runs_df,runs_df,all=TRUE,sort=FALSE)



twothree_noout_runs_df$runsReal<-twothree_noout_runs_df$runs-twothree_noout_runs_df$runsbefore



mean(twothree_noout_runs_df$runsReal,na.rm=T)
table(twothree_noout_runs_df$runsReal)
sum(twothree_noout_runs_df$runsReal)/length(twothree_noout_runs_df$runsReal)
hist(twothree_noout_runs_df$runsReal)

   
   



standarderror19<-sd(twothree_noout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runners on 2nd and 3rd, No outs")))
standarderror19
#95% confidence intervals of the mean
twothree_noout_runs_df$ll<-mean(twothree_noout_runs_df$runsReal,na.rm=T)-1.96*standarderror19
twothree_noout_runs_df$ul<-mean(twothree_noout_runs_df$runsReal,na.rm=T)+1.96*standarderror19

twothree_noout_runs_df$ul[1]
twothree_noout_runs_df$ll[1]

   

   
   

mean(twothree_noout_runs_df$runsReal,na.r=T)-.251/(standarderror19)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```


#32

```{r}

library(dplyr)

twothree_oneout_runs_df<-season[season$base_state_before=="Runners on 2nd and 3rd, One out",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
twothree_oneout_runs_df<- merge(twothree_oneout_runs_df,runs_df,all=TRUE,sort=FALSE)



twothree_oneout_runs_df$runsReal<-twothree_oneout_runs_df$runs-twothree_oneout_runs_df$runsbefore



mean(twothree_oneout_runs_df$runsReal,na.rm=T)
table(twothree_oneout_runs_df$runsReal)
sum(twothree_oneout_runs_df$runsReal)/length(twothree_oneout_runs_df$runsReal)
hist(twothree_oneout_runs_df$runsReal)

   
   



standarderror20<-sd(twothree_oneout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runners on 2nd and 3rd, One out")))
standarderror20
#95% confidence intervals of the mean
twothree_oneout_runs_df$ll<-mean(twothree_oneout_runs_df$runsReal,na.rm=T)-1.96*standarderror20
twothree_oneout_runs_df$ul<-mean(twothree_oneout_runs_df$runsReal,na.rm=T)+1.96*standarderror20

twothree_oneout_runs_df$ul[1]
twothree_oneout_runs_df$ll[1]

   

   
   

mean(twothree_oneout_runs_df$runsReal,na.r=T)-.251/(standarderror20)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```


#33

```{r}

library(dplyr)

twothree_twoouts_runs_df<-season[season$base_state_before=="Runners on 2nd and 3rd, Two outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
twothree_twoouts_runs_df<- merge(twothree_twoouts_runs_df,runs_df,all=TRUE,sort=FALSE)



twothree_twoouts_runs_df$runsReal<-twothree_twoouts_runs_df$runs-twothree_twoouts_runs_df$runsbefore



mean(twothree_twoouts_runs_df$runsReal,na.rm=T)
table(twothree_twoouts_runs_df$runsReal)
sum(twothree_twoouts_runs_df$runsReal)/length(twothree_twoouts_runs_df$runsReal)
hist(twothree_twoouts_runs_df$runsReal)

   
   



standarderror21<-sd(twothree_twoouts_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Runners on 2nd and 3rd, Two outs")))
standarderror21
#95% confidence intervals of the mean
twothree_twoouts_runs_df$ll<-mean(twothree_twoouts_runs_df$runsReal,na.rm=T)-1.96*standarderror21
twothree_twoouts_runs_df$ul<-mean(twothree_twoouts_runs_df$runsReal,na.rm=T)+1.96*standarderror21

twothree_twoouts_runs_df$ul[1]
twothree_twoouts_runs_df$ll[1]

   

   
   

mean(twothree_twoouts_runs_df$runsReal,na.r=T)-.251/(standarderror21)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```


#34

```{r}

library(dplyr)

onetwothree_noouts_runs_df<-season[season$base_state_before=="Bases Loaded, No outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
onetwothree_noouts_runs_df<- merge(onetwothree_noouts_runs_df,runs_df,all=TRUE,sort=FALSE)



onetwothree_noouts_runs_df$runsReal<-onetwothree_noouts_runs_df$runs-onetwothree_noouts_runs_df$runsbefore



mean(onetwothree_noouts_runs_df$runsReal,na.rm=T)
table(onetwothree_noouts_runs_df$runsReal)
sum(onetwothree_noouts_runs_df$runsReal)/length(onetwothree_noouts_runs_df$runsReal)
hist(onetwothree_noouts_runs_df$runsReal)

   
   



standarderror22<-sd(onetwothree_noouts_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Bases Loaded, No outs")))
standarderror22
#95% confidence intervals of the mean
onetwothree_noouts_runs_df$ll<-mean(onetwothree_noouts_runs_df$runsReal,na.rm=T)-1.96*standarderror22
onetwothree_noouts_runs_df$ul<-mean(onetwothree_noouts_runs_df$runsReal,na.rm=T)+1.96*standarderror22

onetwothree_noouts_runs_df$ul[1]
onetwothree_noouts_runs_df$ll[1]

   

   
   

mean(onetwothree_noouts_runs_df$runsReal,na.r=T)-.251/(standarderror22)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```

#35

```{r}

library(dplyr)

onetwothree_oneout_runs_df<-season[season$base_state_before=="Bases Loaded, One out",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
onetwothree_oneout_runs_df<- merge(onetwothree_oneout_runs_df,runs_df,all=TRUE,sort=FALSE)



onetwothree_oneout_runs_df$runsReal<-onetwothree_oneout_runs_df$runs-onetwothree_oneout_runs_df$runsbefore



mean(onetwothree_oneout_runs_df$runsReal,na.rm=T)
table(onetwothree_oneout_runs_df$runsReal)
sum(onetwothree_oneout_runs_df$runsReal)/length(onetwothree_oneout_runs_df$runsReal)
hist(onetwothree_oneout_runs_df$runsReal)

   
   



standarderror23<-sd(onetwothree_oneout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Bases Loaded, One out")))
standarderror23
#95% confidence intervals of the mean
onetwothree_oneout_runs_df$ll<-mean(onetwothree_oneout_runs_df$runsReal,na.rm=T)-1.96*standarderror23
onetwothree_oneout_runs_df$ul<-mean(onetwothree_oneout_runs_df$runsReal,na.rm=T)+1.96*standarderror23

onetwothree_oneout_runs_df$ul[1]
onetwothree_oneout_runs_df$ll[1]

   

   
   

mean(onetwothree_oneout_runs_df$runsReal,na.r=T)-.251/(standarderror23)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB



```


#36

```{r}

library(dplyr)

onetwothree_twoout_runs_df<-season[season$base_state_before=="Bases Loaded, Two outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))
                                                               
onetwothree_twoout_runs_df<- merge(onetwothree_twoout_runs_df,runs_df,all=TRUE,sort=FALSE)



onetwothree_twoout_runs_df$runsReal<-onetwothree_twoout_runs_df$runs-onetwothree_twoout_runs_df$runsbefore



mean(onetwothree_twoout_runs_df$runsReal,na.rm=T)
table(onetwothree_twoout_runs_df$runsReal)
sum(onetwothree_twoout_runs_df$runsReal)/length(onetwothree_twoout_runs_df$runsReal)
hist(onetwothree_twoout_runs_df$runsReal)

   
   



standarderror24<-sd(onetwothree_twoout_runs_df$runsReal,na.rm=T)/sqrt(length(which(season$base_state_before=="Bases Loaded, Two outs")))
standarderror24
#95% confidence intervals of the mean
onetwothree_twoout_runs_df$ll<-mean(onetwothree_twoout_runs_df$runsReal,na.rm=T)-1.96*standarderror24
onetwothree_twoout_runs_df$ul<-mean(onetwothree_twoout_runs_df$runsReal,na.rm=T)+1.96*standarderror24

onetwothree_twoout_runs_df$ul[1]
onetwothree_twoout_runs_df$ll[1]

   

   
   

mean(onetwothree_twoout_runs_df$runsReal,na.r=T)-.251/(standarderror24)

     


   



# The second element of the chart is .543 —  number cited in "The Book" is .297 for the MLB




```


#37

```{r}



season$playType[grepl("[[:space:]]singled",season$play)]<-"single"

season$playType[grepl("[[:space:]]doubled",season$play)]<-"double"

season$playType[grepl("[[:space:]]tripled",season$play)]<-"triple"

season$playType[grepl("[[:space:]]homered",season$play)]<-"home run"
season$playType[grepl("[[:space:]]homered",season$play)]<-"home run"
season$playType[grepl("[[:space:]]walked",season$play)]<-"walk"

season$playType[grepl("[[:space:]]reached[[:space:]]on[[:space:]]an[[:space:]]error",season$play)]<-"reached on error"
season$playType[grepl("[[:space:]]catcher's[[:space:]]interference",season$play)]<-"catcher's interference"
season$playType[grepl("[[:space:]]passed[[:space:]]ball",season$play)]<-"passed ball"
season$playType[grepl("[[:space:]]wild[[:space:]]pitch",season$play)]<-"wild pitch"
season$playType[grepl("[[:space:]]hit[[:space:]]by[[:space:]]pitch",season$play)]<-"hit by pitch"

season$playType[grepl("[[:space:]]stole[[:space:]]",season$play)]<-"stolen base"


season$playType[grepl("[[:space:]]illegal[[:space:]]pitch",season$play)]<-"illegal pitch"

season$playType[grepl("[[:space:]]SAC[[:space:]]bunt",season$play)]<-"SAC bunt"



table(season$playType, season$runs_from_play)



```


#38



```{r}
season$runexp<-NA
season$runexp[season$base_state_before=="Nobody on, No Outs"]<-.656
season$runexp[season$base_state_before=="Nobody on, One out"]<-.31
season$runexp[season$base_state_before=="Nobody on, Two outs"]<-.097

season$runexp[season$base_state_before=="Runner on 1st, No outs"]<-1.1
season$runexp[season$base_state_before=="Runner on 1st, One out"]<-.603
season$runexp[season$base_state_before=="Runner on 1st, Two outs"]<-.23

season$runexp[season$base_state_before=="Runner on 2nd, No outs"]<-1.395
season$runexp[season$base_state_before=="Runner on 2nd, One out"]<-.770
season$runexp[season$base_state_before=="Runner on 2nd, Two outs"]<-.301

season$runexp[season$base_state_before=="Runner on 3rd, No outs"]<-1.517
season$runexp[season$base_state_before=="Runner on 3rd, One out"]<-1.029
season$runexp[season$base_state_before=="Runner on 3rd, Two outs"]<-.411

season$runexp[season$base_state_before=="Runners on 1st and 2nd, No outs"]<-1.769
season$runexp[season$base_state_before=="Runners on 1st and 2nd, One out"]<-1.052
season$runexp[season$base_state_before=="Runners on 1st and 2nd, Two outs"]<-.454

season$runexp[season$base_state_before=="Runners on 1st and 3rd, No outs"]<-1.948
season$runexp[season$base_state_before=="Runners on 1st and 3rd, One out"]<-1.24
season$runexp[season$base_state_before=="Runners on 1st and 3rd, Two outs"]<-.495

season$runexp[season$base_state_before=="Runners on 2nd and 3rd, No outs"]<-2.089
season$runexp[season$base_state_before=="Runners on 2nd and 3rd, One out"]<-1.336
season$runexp[season$base_state_before=="Runners on 2nd and 3rd, Two outs"]<-.566

season$runexp[season$base_state_before=="Bases Loaded, No outs"]<-2.294
season$runexp[season$base_state_before=="Bases Loaded, One out"]<-1.506
season$runexp[season$base_state_before=="Bases Loaded, Two outs"]<-.616

mean(season$runexp[season$playType=="home run"],na.rm=T)
mean(season$runexp[season$playType=="single"],na.rm=T)
mean(season$runexp[season$playType=="double"],na.rm=T)
mean(season$runexp[season$playType=="triple"],na.rm=T)
mean(season$runexp[season$playType=="walk"],na.rm=T)
mean(season$runexp[season$playType=="reached on error"],na.rm=T)
mean(season$runexp[season$playType=="catcher's interference"],na.rm=T)
mean(season$runexp[season$playType=="passed ball"],na.rm=T)
mean(season$runexp[season$playType=="wild pitch"],na.rm=T)
mean(season$runexp[season$playType=="illegal pitch"],na.rm=T)
mean(season$runexp[season$playType=="stolen base"],na.rm=T)
mean(season$runexp[season$playType=="hit by pitch"],na.rm=T)
mean(season$runexp[season$playType=="SAC bunt"],na.rm=T)
mean(season$runexp[season$playType=="bunt"],na.rm=T)
mean(season$runexp[season$playType=="out"],na.rm=T)
mean(season$runexp[season$playType=="stolen base"],na.rm=T)
mean(season$runexp[season$playType=="strikeout"],na.rm=T)
```

#39

```{r}

#Home Run

homerun_df<-season[season$playType=="home run",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

homerun_df<- merge(homerun_df,runs_df,all=TRUE,sort=FALSE)

#Runs to the end of inning after a home run

homerun_df$runsReal<-homerun_df$runs-homerun_df$runsbefore

#RTOE (average) of a HR

mean(homerun_df$runsReal,na.rm=T)

standarderrorhomerun<-sd(homerun_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="home run")))
  


```


#40

```{r}

single_df<-season[season$playType=="single",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

single_df<- merge(single_df,runs_df,all=TRUE,sort=FALSE)



single_df$runsReal<-single_df$runs-single_df$runsbefore



mean(single_df$runsReal,na.rm=T)
hist(single_df$runsReal)



standarderrorsingle<-sd(single_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="single")))


```

#41
```{r}

double_df<-season[season$playType=="double",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

double_df<- merge(double_df,runs_df,all=TRUE,sort=FALSE)



double_df$runsReal<-double_df$runs-double_df$runsbefore



mean(double_df$runsReal,na.rm=T)
standarderrordouble<-sd(double_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="double")))


```

#42

```{r}

triple_df<-season[season$playType=="triple",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

triple_df<- merge(triple_df,runs_df,all=TRUE,sort=FALSE)



triple_df$runsReal<-triple_df$runs-triple_df$runsbefore



mean(triple_df$runsReal,na.rm=T)

standarderrortriple<-sd(triple_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="triple")))

```

#43
```{r}

walk_df<-season[season$playType=="walk",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

walk_df<- merge(walk_df,runs_df,all=TRUE,sort=FALSE)



walk_df$runsReal<-walk_df$runs-walk_df$runsbefore



mean(walk_df$runsReal,na.rm=T)

standarderrorwalk<-sd(walk_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="walk")))

```

#44

```{r}

error_df<-season[season$playType=="reached on error",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

error_df<- merge(error_df,runs_df,all=TRUE,sort=FALSE)



error_df$runsReal<-error_df$runs-error_df$runsbefore



mean(error_df$runsReal,na.rm=T)

standarderrorerror<-sd(error_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="reached on error")))
standarderrorerror
```

#45

```{r}

interference_df<-season[season$playType=="catcher's interference",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

interference_df<- merge(interference_df,runs_df,all=TRUE,sort=FALSE)



interference_df$runsReal<-interference_df$runs-interference_df$runsbefore



mean(interference_df$runsReal,na.rm=T)

standarderrorinterference<-sd(interference_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="catcher's interference")))

```


#46

```{r}

passedball_df<-season[season$playType=="passed ball",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

passedball_df<- merge(passedball_df,runs_df,all=TRUE,sort=FALSE)



passedball_df$runsReal<-passedball_df$runs-passedball_df$runsbefore



mean(passedball_df$runsReal,na.rm=T)

standarderrorpassedball<-sd(passedball_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="passed ball")))

```

#47

```{r}

wildpitch_df<-season[season$playType=="wild pitch",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

wildpitch_df<- merge(wildpitch_df,runs_df,all=TRUE,sort=FALSE)



wildpitch_df$runsReal<-wildpitch_df$runs-wildpitch_df$runsbefore



mean(wildpitch_df$runsReal,na.rm=T)

standarderrorwildpitch<-sd(passedball_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="wild pitch")))

```

#48

```{r}

illegalpitch_df<-season[season$playType=="illegal pitch",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

illegalpitch_df<- merge(illegalpitch_df,runs_df,all=TRUE,sort=FALSE)



illegalpitch_df$runsReal<-illegalpitch_df$runs-illegalpitch_df$runsbefore



mean(illegalpitch_df$runsReal,na.rm=T)

standarderrorillegalpitch<-sd(illegalpitch_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="illegal pitch")))

```

#49

```{r}

steal_df<-season[season$playType=="stolen base",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

steal_df<- merge(steal_df,runs_df,all=TRUE,sort=FALSE)



steal_df$runsReal<-steal_df$runs-steal_df$runsbefore



mean(steal_df$runsReal,na.rm=T)

standarderrorsteal<-sd(steal_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="stolen base")))

```

#50

```{r}

HBP_df<-season[season$playType=="hit by pitch",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

HBP_df<- merge(HBP_df,runs_df,all=TRUE,sort=FALSE)



HBP_df$runsReal<-HBP_df$runs-HBP_df$runsbefore



mean(HBP_df$runsReal,na.rm=T)

standarderrorhitbypitch<-sd(HBP_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="hit by pitch")))

```

#51

```{r}

season$playType[grepl("[[:space:]]SAC[[:space:]]bunt",season$play)]<-"SAC bunt"


SAC_df<-season[season$playType=="SAC bunt",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

SAC_df<- merge(SAC_df,runs_df,all=TRUE,sort=FALSE)



SAC_df$runsReal<-SAC_df$runs-SAC_df$runsbefore



mean(SAC_df$runsReal,na.rm=T)

standarderrorSAC<-sd(SAC_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="SAC bunt")))

```


#52

```{r}

season$playType[grepl("bunt",season$play)]<-"bunt"

bunt_df<-season[season$playType=="bunt",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

bunt_df<- merge(bunt_df,runs_df,all=TRUE,sort=FALSE)



bunt_df$runsReal<-bunt_df$runs-bunt_df$runsbefore



mean(bunt_df$runsReal,na.rm=T)

standarderrorbunt<-sd(bunt_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="bunt")))

```

#53

```{r}

season$playType[season$outs_from_play==1]<-"out"

out_df<-season[season$playType=="out",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

out_df<- merge(out_df,runs_df,all=TRUE,sort=FALSE)



out_df$runsReal<-out_df$runs-out_df$runsbefore


mean(out_df$runsReal,na.rm=T)

standarderrorout<-sd(out_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="out")))


```

#54

```{r}

season$playType[grepl("[[:space:]]struck[[:space:]]out",season$play)]<-"strikeout"


K_df<-season[season$playType=="strikeout",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

K_df<- merge(K_df,runs_df,all=TRUE,sort=FALSE)



K_df$runsReal<-K_df$runs-K_df$runsbefore


mean(K_df$runsReal,na.rm=T)

standarderrorK<-sd(K_df$runsReal,na.rm=T)/sqrt(length(which(season$playType=="strikeout")))


```

#55

```{r}

#Creating a dataset for play types (Run Exp based on ^{37})
standarderrorsplays<-c(standarderrorhomerun,standarderrortriple,standarderrordouble,standarderrorsingle,standarderrorwalk,standarderrorhitbypitch,standarderrorout,standarderrorK,standarderrorinterference,standarderrorerror,standarderrorillegalpitch,standarderrorwildpitch,standarderrorpassedball,standarderrorsteal,standarderrorSAC,standarderrorbunt)
playType <- c("home run","triple","double","single","walk","hit by pitch","out","strikeout", "catcher's interference", "error","illegal pitch", "wild pitch", "passed ball","stolen base","SAC bunt","bunt")
RTOE <- c(2.169, 1.721, 1.483, .860, .875, 1.03, .296, .242, .9714, 1.117, 1.363, 1.077, 1.044, 1.011, .912, .9442)
run_exp <- c(.6727,.6413,.6765,.654,.6519,.6649,.6473,.6282,.6378,.643,.916,.8115,.8087, .814, 1.186, .8513)
playvalue<-data.frame(playType,RTOE,run_exp)

#Expected Gain from event

playvalue$ExpectedGain<-playvalue$RTOE-playvalue$run_exp

#Value of an out
playvalue$outvalue<-.296


#The base value of an event relative to the out

playvalue$OBAcoeffbase<-with(playvalue, RTOE-outvalue)

#Applying the base value coefficients

Softball_Stats2016$mybaseOBA<-(.579*Softball_Stats2016$BB+.734*Softball_Stats2016$HBP+.564*Softball_Stats2016$oneB+1.187*Softball_Stats2016$twoB+1.425*Softball_Stats2016$threeB+1.873*Softball_Stats2016$HR+.821*Softball_Stats2016$RBOE)/(Softball_Stats2016$AB+Softball_Stats2016$BB+Softball_Stats2016$IBB+Softball_Stats2016$SH+Softball_Stats2016$SF+Softball_Stats2016$HBP)

#Discerning the weight needed so the average of myOBA is relatively equal to OBP

mean(Softball_Stats2016$mybaseOBA)
Softball_Stats2016$OBP<-(Softball_Stats2016$BB+Softball_Stats2016$HBP+Softball_Stats2016$oneB+Softball_Stats2016$twoB+Softball_Stats2016$threeB+Softball_Stats2016$HR)/(Softball_Stats2016$AB+Softball_Stats2016$BB+Softball_Stats2016$IBB+Softball_Stats2016$SH+Softball_Stats2016$SF+Softball_Stats2016$HBP)
mean(Softball_Stats2016$OBP)
mean(Softball_Stats2016$OBP)/mean(Softball_Stats2016$mybaseOBA)

#Creating the OBA coefficients

playvalue$OBAcoeff<-with(playvalue, OBAcoeffbase*1.23)
```

#56

```{r}

#Coding myOBA

Softball_Stats2016$myOBA<-(.712*Softball_Stats2016$BB+.903*Softball_Stats2016$HBP+.694*Softball_Stats2016$oneB+1.46*Softball_Stats2016$twoB+1.753*Softball_Stats2016$threeB+2.304*Softball_Stats2016$HR+1.010*Softball_Stats2016$RBOE)/(Softball_Stats2016$AB+Softball_Stats2016$BB+Softball_Stats2016$IBB+Softball_Stats2016$SH+Softball_Stats2016$SF+Softball_Stats2016$HBP)


# Creating a function marking winning % and myOBA
lmmwSoftballOBA2016<-lm(with(Softball_Stats2016, PCT~myOBA))
lmmwSoftballOBA2016
lmmwSoftballOBA2016R<-lm(with(Softball_Stats2016, R~myOBA))
lmmwSoftballOBA2016R
rsquared(lmmwSoftballOBA2016R)

#Creating predictions based on the function

Softball_Stats2016$fit <- predict(lmmwSoftballOBA2016)
Softball_Stats2016$ul <- Softball_Stats2016$fit + 1.96 * predict(lmmwSoftballOBA2016, se.fit = T)$se
Softball_Stats2016$ll <- Softball_Stats2016$fit - 1.96 * predict(lmmwSoftballOBA2016, se.fit = T)$se






Softball_Stats2016$fit2 <- predict(lmmwSoftballOBA2016)
Softball_Stats2016$ul2 <- Softball_Stats2016$fit2 + 1.96 * predict(lmmwSoftballOBA2016, se.fit = T)$se
Softball_Stats2016$ll2 <- Softball_Stats2016$fit2 - 1.96 * predict(lmmwSoftballOBA2016, se.fit = T)$se



#Looking at the distribution of Softball wOBAs, looks normal
hist(Softball_Stats2016$myOBA)

#2015

Softball_Stats2015$myOBA<-(.712*Softball_Stats2015$BB+.903*Softball_Stats2015$HBP+.694*Softball_Stats2015$oneB+1.46*Softball_Stats2015$twoB+1.753*Softball_Stats2015$threeB+2.304*Softball_Stats2015$HR+1.010*Softball_Stats2015$RBOE)/(Softball_Stats2015$AB+Softball_Stats2015$BB+Softball_Stats2015$IBB+Softball_Stats2015$SH+Softball_Stats2015$SF+Softball_Stats2015$HBP)



lmmwSoftballOBA2015<-lm(with(Softball_Stats2015, PCT~myOBA))
lmmwSoftballOBA2015
lmmwSoftballOBA2015R<-lm(with(Softball_Stats2015, R~myOBA))
lmmwSoftballOBA2015R
rsquared(lmmwSoftballOBA2015R)




Softball_Stats2015$fit <- predict(lmmwSoftballOBA2015)
Softball_Stats2015$ul <- Softball_Stats2015$fit + 1.96 * predict(lmmwSoftballOBA2015, se.fit = T)$se
Softball_Stats2015$ll <- Softball_Stats2015$fit - 1.96 * predict(lmmwSoftballOBA2015, se.fit = T)$se






Softball_Stats2015$fit2 <- predict(lmmwSoftballOBA2015R)
Softball_Stats2015$ul2 <- Softball_Stats2015$fit2 + 1.96 * predict(lmmwSoftballOBA2015R, se.fit = T)$se
Softball_Stats2015$ll2 <- Softball_Stats2015$fit2 - 1.96 * predict(lmmwSoftballOBA2015R, se.fit = T)$se





rsquared(lmmwSoftballOBA2015)


hist(Softball_Stats2015$myOBA)


#2014

Softball_Stats2014$myOBA<-(.712*Softball_Stats2014$BB+.903*Softball_Stats2014$HBP+.694*Softball_Stats2014$oneB+1.46*Softball_Stats2014$twoB+1.753*Softball_Stats2014$threeB+2.304*Softball_Stats2014$HR+1.010*Softball_Stats2014$RBOE)/(Softball_Stats2014$AB+Softball_Stats2014$BB+Softball_Stats2014$IBB+Softball_Stats2014$SH+Softball_Stats2014$SF+Softball_Stats2014$HBP)



lmmwSoftballOBA2014<-lm(with(Softball_Stats2014, PCT~myOBA))
lmmwSoftballOBA2014
lmmwSoftballOBA2014R<-lm(with(Softball_Stats2014, R~myOBA))
lmmwSoftballOBA2014R
rsquared(lmmwSoftballOBA2014R)
anova(lmmwSoftballOBA2014,lmwSoftballOBA2014)



Softball_Stats2014$fit <- predict(lmmwSoftballOBA2014)
Softball_Stats2014$ul <- Softball_Stats2014$fit + 1.96 * predict(lmmwSoftballOBA2014, se.fit = T)$se
Softball_Stats2014$ll <- Softball_Stats2014$fit - 1.96 * predict(lmmwSoftballOBA2014, se.fit = T)$se






Softball_Stats2014$fit2 <- predict(lmmwSoftballOBA2014R)
Softball_Stats2014$ul2 <- Softball_Stats2014$fit2 + 1.96 * predict(lmmwSoftballOBA2014R, se.fit = T)$se
Softball_Stats2014$ll2 <- Softball_Stats2014$fit2 - 1.96 * predict(lmmwSoftballOBA2014R, se.fit = T)$se


rsquared(lmmwSoftballOBA2014)

#Looking at the distribution of Softball wOBAs, looks normal
hist(Softball_Stats2014$myOBA)


```

#57
```{r}

#Creating MLB datasets
baseoutstates<-(c("Nobody on","Runner on 1st","Runner on 2nd","Runner on 3rd","Runners on 1st and 2nd","Runners on 1st and 3rd","Runners on 2nd and 3rd","Bases Loaded"))
NoOuts<-c(.555,.953,1.189,1.482,1.573,1.904,2.052,2.417)
OneOut<-c(.297,.573,.725,.983,.971,1.243,1.467,1.650)
TwoOuts<-c(.117,.251,.344,.387,.466,.538,.634,.815)
MLBBOStates<-data.frame(baseoutstates,NoOuts,OneOut,TwoOuts)

playTypeMLB <- c("home run","triple","double","single","walk","hit by pitch","out","strikeout", "catcher's interference", "error","illegal pitch", "wild pitch", "passed ball","stolen base","SAC bunt","bunt")
RTOEMLB <- c(1.942, 1.616, 1.311, 1.025, .849, .969, .240, .207, 1.083, 1.132, .949, 1.000, 1.026, .792, 1.031, .481)
run_expMLB <- c(.533,.553,.547,.551,.520,.584,.538,.517,.655,.586,.712,.716,.741, .597, 1.058, .409)
playvalueMLB<-data.frame(playTypeMLB,RTOEMLB,run_expMLB)

```


#58
```{r}



```





# Question

"The Book: Playing the Percentages in baseball"_{1} starts with a handy first chapter aptly titled "Toolshed," in which it discusses fundamental tenants of statistical understanding necessary to evaluate trends and values in baseball. For softball, a sport played by women on a different field with different equipment, the accepted theory — as far as I have surmised on my admittedly-less-than-extensive search of the internet for advanced softball statistics — is that the sport follows a pattern similar to baseball. 

This affects our understanding of softball. Statistics like wOBA (weighted on-base average), generated from MLB play data, have been used to explain the value of plays as if the sports were similar. This is the wOBA equation, with coefficients derived from the play's — i.e single, double, etc. — relative run value compared to the out. 


  {MLB's wOBA}    ({.90 *  Singles} + {1.24*  Doubles} + {1.56*  Triples} + {1.95*  Home runs} + {.75*  Hit-By-Pitches} + {.72*  Walks} +{.90*  Reached Base on Error}) /   {Plate Appearances}  


In fact, a post_{2} on fastpitchanalytics.com closes with the author's desire to evaluate softball with different coefficients for the wOBA statistic specifically for softball but used MLB's statistic to evaluate the top hitting teams in the country.

Using basic statistics provided by the NCAA website for all teams in 2016, we can see how well wOBA fits teams' ability to score runs — one of the most effective metrics in evaluating a team's offense and its ability to win games. 

- **H** hits 
- **oneB** singles^{1}
- **RBOE** Reached Base on Error^{1}
- **twoB** doubles
- **threeB** triples
- **HR** home runs
- **BB** walks
- **HBP** hit-by-pitch
- **AB** at-bats
- **IBB** intentional walks
- **SH** sacrifice hits
- **SF** sacrifice flies

\[
  {Runs}    1 +   {Team wOBA} 
\]


  {Winning %}    1 +   {Team wOBA} 


We first create and look at two functions, one modelling the wOBA and runs and the other modelling wOBA and a team's winning percentage. wOBA is the independent variable, and runs and winning percentage are both dependent variables, respectively. 

```{r}
lmwSoftballOBA2016<-lm(with(Softball_Stats2016, PCT~wOBA))
lmwSoftballOBA2016
rsquared(lmwSoftballOBA2016)
lmwSoftballOBA2016R<-lm(with(Softball_Stats2016, R~wOBA))
lmwSoftballOBA2016R
rsquared(lmwSoftballOBA2016R)
lm1Softball<-lm(with(Softball_Stats2016, R~oneB+twoB+threeB+HR+BB+RBOE+HBP))
lm1Softball
rsquared(lm1Softball)
```

There is a much stronger positive correlation with runs and wOBA, with 83% of the variance in runs explained by the team's wOBA. The distribution of wOBA is normal, as seen below, and there are few outliers — though some on the extremes, as is well-modelled by the confidence intervals of the graphed functions. 

I also included an optimization of all the coefficients in wOBA, which may show us a clue of the possible trends we may see in what's to come. Of course, this operates with no premise of how valuable each individual play; it merely shows association between being good at one statistic — for example, triples — can translate into better runs totals. What wOBA also takes into account is the weight of each type of play in respect to its run creation value. So, if a team hits more triples, that's still good, but the coefficient reflects an average amount of runs that are created — which is less than home runs, which obviously makes sense. 

```{r}

hist(Softball_Stats2016$wOBA)

#Plot the function with the dataset
plot(x= Softball_Stats2016$wOBA, y=Softball_Stats2016$R,
     xlab="wOBA", ylab = "R")
abline(lmwSoftballOBA2016R,col="red")

Softball_Stats2016$fitwOBA<-predict(lmwSoftballOBA2016R)
Softball_Stats2016$fit2 <- predict(lmwSoftballOBA2016R)
Softball_Stats2016$ul2 <- Softball_Stats2016$fit2 + 1.96 * predict(lmwSoftballOBA2016R, se.fit = T)$se
Softball_Stats2016$ll2 <- Softball_Stats2016$fit2 - 1.96 * predict(lmwSoftballOBA2016R, se.fit = T)$se

plot<-ggplot(data = Softball_Stats2016, aes(x=wOBA,y=fit2))+geom_line()+geom_ribbon(aes(ymin = ll2, ymax = ul2), col = "grey", alpha = 0.25) + labs(x = "wOBA", y = "Predicted Runs Scored")
plot

```

Though not perfect comparisons, it is illumnating to look at how wOBA models baseball statistics. Unfortunately, softball's records are better kept and including reached base on error is not possible without knowing certain variables. The distribution of wOBA's for baseball is similarly normal — though shifted left — and, again, the r squared value is significantly better for runs than winning percentage.

```{r}

hist(BaseballOStats2016$wOBA)

lmwBaseballOBA2016R<-lm(with(BaseballOStats2016, R~wOBA))
lmwBaseballOBA2016R
rsquared(lmwBaseballOBA2016R)
lmwBaseballOBA2016<-lm(with(BaseballOStats2016, PCT~wOBA))
lmwBaseballOBA2016
rsquared(lmwBaseballOBA2016)

```

Two notes here: One, softball's r squared function for runs is much higher, which might lend one to think that wOBA works for softball more than baseball. However, we see that PCT is much more correlated for baseball than softball; if anything, this seems to be an indictment of anyone who thinks errors should not be included in datakeeping, as it adds an element of explanation to run totals. 

*I repeated this process for 2015 and 2014 in the code appendix. The results are similar, though there might be a slight error in the data tallying of win percentages. Either way, the important thing to focus on is the statistics relationship to runs.^{1}

```{r}
plot(x= BaseballOStats2016$wOBA, y=BaseballOStats2016$R,
     xlab="wOBA", ylab = "R")
abline(lmwBaseballOBA2016R,col="red")

BaseballOStats2016$fitwOBA<-predict(lmwBaseballOBA2016R)
BaseballOStats2016$fit2 <- predict(lmwBaseballOBA2016R)
BaseballOStats2016$ul2 <- BaseballOStats2016$fit2 + 1.96 * predict(lmwBaseballOBA2016R, se.fit = T)$se
BaseballOStats2016$ll2 <- BaseballOStats2016$fit2 - 1.96 * predict(lmwBaseballOBA2016R, se.fit = T)$se

plot2<-ggplot(data = BaseballOStats2016, aes(x=wOBA,y=fit2))+geom_line()+geom_ribbon(aes(ymin = ll2, ymax = ul2), col = "grey", alpha = 0.25) + labs(x = "wOBA", y = "Predicted Runs Scored")
plot2

```

There are a lot of indicators that point to potential differences, including the average of singles hit by each team for each sport. Softball's total numbers are a little inflated because it comes from a larger gameset, so this exercise shows that there is a statistically significant difference in the proportion of singles among the two sports. Both distributions appear fairly normal.   

```{r}
hist(Softball_Stats2016$oneB)
hist(BaseballOStats2016$oneB)
testA<-Softball_Stats2016$oneB/Softball_Stats2016$AB
testB<-BaseballOStats2016$oneB/BaseballOStats2016$AB
mean(testA)
mean(testB)
sd(testA)
sd(testB)

mean(testA)-mean(testB)/sqrt(((sd(testA)^2)/295)+((sd(testB)^2)/299))
```

These evaluations are a precursor to my question. In order to statistically understand the sport of softball, we must compare the foundations of sabermetrics and advanced statistics between softball and baseball. wOBA is one of the individual statistics highlighted in that first chapter of "The Book" because the statistics combines the positives of on-base percentage and slugging percentage and weights it such that it is equitable to OBP. In order to apply a statistic such as wOBA — the constants of which are derived from play-type run values — we need to make sure that the foundations behind those constants and its application fit the sport to the best of its ability. Comparing the function across both softball and baseball statistics illustrates just this fact. The differences in the data alone is enough to signal that there might be ways to differentiate the two sports.

The underlying principle here is that statistics is fundamental to our understanding of how to evaluate players and teams and in-game decision-making. If there's a person on first and no outs, should a team sacrifice the hitter to move the runner to second? What player is more valuable to a team, the power hitter with low speed or the speedster that can turn doubles into triples and steal bases? When evaluating a team's offense, how can we weigh the importance of singular events? 

The statistic at the core of this understanding is run expectancy per base/out state. There are 24 run/out states, comprised of the different combinations of baserunners possible at any given time — such as runner on first, bases loaded, runners on the corners, etc. — and the different possible amount of outs in the inning — 0, 1, 2. These values are critical in determining whether the same situation in softball at all corresponds to the same situation in baseball. For example, these values were able to highlight the inefficiency of a sacrifice bunt in baseball, as run expectancy falls from pre-sacrifice bunt to after it. 

Once I can evaluate how many runs are expected to arise from each individual situation, I can dive further into the run values from individual events and various changes in run expectancies across both base-states and events. 

# Data

The team statistical data was scraped from the NCAA's official statistics website_{3}, which provides almost all of the simplistic stats that necessitate little to no calculation or derivation. 

The data for the play-by-play is by far the most important part of this entire project. I got the play-by-play data from user 'octonian' on github_{4}, who had a plethora of softball data and code stored in his account on the website. However, the raw data he provided was relatively unreadable, as the playIDs were the only indicators of what resulted from the specific play. 

The raw data needs three things in order for it to be appropriately utilizable for the project — a measure of outs, a measure of runs and a measure of the people on base in a given situation. These are the three variables that can give us run expectancy from each of the identified states as long as I can properly attribute every play with its result. 

New variables

- **gameID** every individual game is given a numeric code labelled as 'game ID'
- **playID** & **play** the description of a play, which includes the event and the movement of baserunners
- **inningID** every inning in every game is given a numeric code labbled as 'inning ID'

## Outs

The first step is to create numeric indicators for outs^{3}. There were a few challenges in doing so, as batters reached base despite "striking out". This was also a good time to evaulate data by surveying random games, and I noticed that beyond the inning summaries that were already removed, there were a number of plays — such as substitions and "No play"s — that needed to be removed from the dataset.

Outs_from_play is a category that takes the indicators of outs in the playID and assigns a value of 0 (if there is no out on the play), 1 (if there is an out) and 2 (if there is a double play). There is no value for a triple play because there was no occurence of a triple play in the data. 

```{r}
hist(season$outs_from_play)
```

### One game

This gives us a metric for the outs created from the play, but — when we are evaluating the base/out states — we need to know how many outs are there while a play is occuring. This requires us to apply the column that we just created across the entire dataset, looping our count of the outs such that we can dilineate between the top and bottom of every inning and how many outs have happened before a certain play. This allows to keep a running tally of the outs in an inning, the outs that have occured before a given play and the outs that occured as a result of a given play.

The next step is to then create those columns and apply it to one game — as compared to a datset with over 2000 games. 

Looking at the data, we can see that we have successfully translated^{4} the outs from one play to the next and have the appropriate accumulations for each column. Also, we can now differentiate between the top and bottom of innings based on the amount of outs, which will be important moving forward as we track the runs scored and separate baserunners on either side of an inning. 

### Entire Season

Now, we must repeat the process for the entire season, reapplying the code^{5} that worked for the dataset "game" to the dataset "season". There are not many ways to completely check the dataset for potential errors other than line-by-line checking, but there are some commands toward the end of the code that can functionally check that the code was properly applied.

```{r}
summary(season$outs_before_play)
hist(season$outs_before_play)
```

After eliminating the games in which the outs were possibly missapplied indicated by an instance of three outs in an ongoing inning, there is still a wealth of data in the dataset of which to analyze. 

New variables

- **total_outs_in_inning** the amount of outs in the inning after the play has occured
- **outs_before_play** the amount of outs in the inning before the play has occured
- **outs_from_play** the amount of outs that occur as a result of the play
- **top_bottom** an all-important variable that differentiates the top and the bottom of an individual inning based on three outs occuring (all plays before out 3 = top, all plays after out 3 = bottom, play in which out 3 occured = top)

##Runs

The next step in shaping our data is to create a similarly coded metric for runs that can be identified from the playID, allocate the proper amount of runs to the play, count the runs in an individual inning and establish the amount of runs that have occured before a play. 

First, we start with creating a measure of runs similar to the outs beforehand. Instead of searching for words like out, we look for "RBI" and "scored". There were a few different approaches here: One, there needed to be the proper appropriation of runs according to the amount of RBI listed in the playID. Secondly, since it's difficult to parse between generic "RBI" and "2 RBI," I wrote the code such that the character preceding the space before RBI needed to be alphabetic — or non-numeric. That allowed me to create a measure for 1 RBI. Also, not all runs are scored via an RBI — some are from wild pitches, passed balls or random fielding mistakes. I assigned those events one run for the "scored" character string in playID despite the fact that there may have been more than one run scored on the play. I thought about appropriating the distribution of amount of runs scored in plays in which a run was scored, but it's even more increasingly less likely that multiple runs will scored in these instances. Therefore, I think that any possible error in that assignment of runs will be insignificant when looking at the final results.^{6}

```{r}
length(season$runs_from_play!=0)
table(season$runs_from_play)
```

### Creating a measure of runs for one game

We now have created a metric in which all of the runs resulting from one play are assigned to the number of runs created. Moving forward, we need to borrow the pattern for accumulating outs and apply it for accumulating runs — making sure that we are basing runs per inning on the number of outs such that the columns correctly accumulate. Next, code for one game and check to make sure everything works properly. ^{7}

```{r}



pandoc.table(season[season$gameID==4032168&season$inningID==0,c("play","top_bottom","runs_before_play")])

pandoc.table(season[season$gameID==4032168&season$inningID==1,c("play","top_bottom","runs_before_play")])

pandoc.table(season[season$gameID==4032168&season$inningID==2,c("play","top_bottom","runs_before_play")])


pandoc.table(season[season$gameID==4032168&season$inningID==3,c("play","top_bottom","runs_before_play")])

pandoc.table(season[season$gameID==4032168&season$inningID==4,c("play","top_bottom","runs_before_play")])
```

### Entire season

Now, just like we did for outs, we apply the same code that we used on one game to the entire season. The distribution of total_runs_in_inning is heavily skewed to one, which makes sense if we consider the distribution of the amount of RBIs per play. The distribution of runs_before_play, which measures the amount of runs before play on either half of an inning tells a good story of the amount of runs scored per inning.^{8}

```{r}
table(season$total_runs_in_inning)
table(season$runs_before_play)
```

A potential source of error could be that we do not account for the runs on a walk-off hit, because total_runs_in_inning is not separated by side and runs_before_play resets after a walk-off hit. If anything, this would slightly depreciate hit values and high order base-out states, but there aren't many  games that are walked-off and the amount of base-out states and events make any micro changes fairly insignifcant, which I will discuss later.

### New variables


- **total_runs_in_inning** the amount of runs in the inning after the play has occured
- **runs_before_play** the amount of runs in the inning before the play has occured
- **runs_from_play** the amount of runs that occur as a result of the play

## Base-Out States

Base-Out states are a component that describe who is on base before and after a certain event, which is fundamental to our understanding of both plays and changes in the game based on what occurs. 

###Indicators

In order to start extrapolating the base-out states from the data, the first step was to make indicators for the baserunners that moved along the bases. Advanced to second, advanced to third are two of the major ones; hitting a double such that a runner is on second and no one is on first; clearing the bases with a home run, etc. Through trial and error, I coded for five new variables:^{9}

- **firstbase** an indicator describing whether a runner is on first (1 if yes, 0 if no)
- **secondbase** an indicator describing whether a runner is on second (1 if yes, 0 if no)
- **thirdbase** an indicator describing whether a runner is on third (1 if yes, 0 if no)
- **temp** an indicator describing whether the play falls under a special, enumerated condition that requires different coding later (1 if the batter is on first, 2 if a runner stole second, 3 if a runner stole third, 4 if the batter is going to first and a runner is advancing to second, 5 if a batter advances past first on an error or throw, 6 if a runner is caught stealing)
- **base_state_after** an indicator describing who is on base and how many outs there are 
(Nobody on, No Outs; Nobody on, One out; Nobody on, Two outs; Runner on 1st, No Outs; Runner on 1st, One out; Runner on 1st, Two outs; Runner on 2nd, No Outs; Runner on 2nd, One out; Runner on 2nd, Two outs; Runner on 3rd, No Outs; Runner on 3rd, One out; Runner on 3rd, Two outs; Runners on 1st and 2nd, No Outs; Runners on 1st and 2nd, One out; Runners on 1st and 2nd, Two outs; Runners on 1st and 3rd, No Outs; Runners on 1st and 3rd, One out; Runners on 1st and 3rd, Two outs; Runners on 2nd and 3rd, No outs; Runners on 2nd and 3rd, One out; Runners on 2nd and 3rd, Two outs; Bases Loaded, No outs; Bases Loaded, One out; Bases Loaded, Two outs)

At this point, there's nothing remarkable about the data. No distribution of any of these codes do the final product justice.

###Entire Season

Coding for the entire season's base-out states require a process somewhat similar to the code for outs and runs before, in which the states loop about the top and the bottom of innings. However, in this case, we need to make sure that 

-**base_state_before** an indicator describing the base-state before the event with the same indicators as base_state_after

reads "Nobody on, No Outs" at the start of every inning.^{10}

Also, we need to make sure that if an out occurs on a given play, the base-state stays the same unless otherwise stated, as in the case of a sacrifice fly. For every out, the next base_state_before retained the baserunners but changed the number of outs. That takes care of the changes in state after an out, which make up a significant portion of the events in a game.

However, the trickiest part — and the way to replace the rest of the "placeholders" — is to code for the previously enumerated special conditions and the resulting changes in state. These are varied based on the condition, but basically the code needed to understand that runners could stay on a base while other runners advanced. 

I repeated both of these codes four times because each time the code is replicated, the base-state changes theoretically until there are fewer and fewer placeholders. After doing it four times, I felt that the base_state_before column had significant tallies to move forward. The resulting placeholders represent gaps in this coding; however, there are relatively few compared to the sheer amount of data in the dataset.^{11,11.2,11.3,11.4}

```{r}
table(season$base_state_before)
```
## Play Types

One important part of the data that is relatively easy to code is the playTypes — which correspond to what happened during each at-bat. Because there are a significant amount of possibilities that could have occured, we can just create a column that extrapolates the result of the at-bat and save that for later.^{37} For convenience, I have coded for some of the major plays and tabled them, which gives a value of how many runs on average are created by the event (during the course of the play). 

```{r}
table(season$playType)
table(season$playType,season$runs_from_play)
```

*This table actually helped me detect an error for solo home runs that made me go back and figure out how to properly code for a singular RBI. Portals of discovery.

- **playType** an indicator describing the type of play that occurs  
(home run, single, double, triple, walk, error, interference, out, bunt, SAC bunt, hit by pitch, strike out, illegal pitch, wild pitch, passed ball, steal)


# Expectations

I expect to uncover fundamental differences between softball and baseball that will transform the way that current statisticians equate the two sports. The following are the base-out state run expectancy chart for the MLB and the chart for the run value of events in the MLB^{57}, including the run expectancy before each event._{1}

```{r}
pandoc.table(MLBBOStates)
pandoc.table(playvalueMLB)
```

- **run_exp** the run expectancy after a unique event in **playType**
- **RTOE** the average runs to the end of an inning after a unique event in **playType**

Of the listed possibilites during a single at-bat, I expect to see events like stolen bases, errors, walks and bunts to matter significantly more as opposed to the heavy emphasis that baseball places on extra-base hits. Because of these differences in values for certain plays, I expect to find undervalued events and skillsets that baseball may ignore but softball should specifically highlight. 

Based on these expectations, I expect to find that there will not only be differences in the constants in the wOBA expression, but also some variables will be weighted more than others differently than the MLB's wOBA. For example, if errors are going to be worth more, than the constant might be well higher than singles, for example. 

  {MLB's wOBA}    (  {Singles} +   {Doubles} +   {Triples} +   {Home runs} +  {Hit-By-Pitches} +   {Walks} 
+  {Reached Base on Error}) /   {Plate Appearances} 


Overall, I expect to find that softball follows a holistically different pattern than baseball. The dimensions of the field are much different; the bases are closer together; the ball is larger; the outfield is smaller, etc. Whether that will manifest itself in a special reliance on home run hitters, speedy players, great defensive players or pitchers is what I expect to figure out. 

Formula wise, this project is based mostly on data-shaping and reading and testing the results, but the observations are inherently formulaic — and the end result is to come up with a statistic based on the wOBA format that properly explains a hitter's individual value and a team's ability to win based on their hitting performance. 


  {Runs}    1 +   {Team wOBA}
  {Runs}    1 +   {Team mywOBA}



  {Winning %}    1 +   {Team wOBA} 
  {Winning %}    1 +   {Team myOBA} 


The above two comparisons are the other hypothesis tests of this project, evaluating the differences in the coefficients for both winning percentage and runs. 

# Analysis

## Softball's base-out state chart

The first step was to analyze the maximum amount of runs in each inning, which can be seen in the runs_df data set here.^{12}

- **runs** the maximum amount of runs in each half of an inning

```{r}

library(dplyr)
runs_df<-season %>% dplyr::group_by(gameID,inningID,top_bottom)%>%
  dplyr::summarize(
      runs=max(runs_before_play,na.rm=T)
  )

summary(runs_df$runs)
length(runs_df$runs)
hist(runs_df$runs)
```

The summary shows us the average amount of runs scored per inning, of which there are 26,472. The distribution of runs is, as expected based on the distribution of runs_before_play in the dataset, heavily skewed towards one, but we can see that it extends to a fairly unfortunate inning — it happens.

The next step is to create a similar dataset tracking the average runs_before_play for each of the 24 base-states in base_state_before for each inning and then subtract that from the max in each inning. That way, the resulting column is the average of the amount of runs after the base-state occurs. For example: ^{13}

```{r}

library(dplyr)
nooneon_noout_runs_df<-season[season$base_state_before=="Nobody on, No Outs",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play, na.rm=T))

nooneon_noout_runs_df<- merge(nooneon_noout_runs_df,runs_df,all=TRUE,sort=FALSE)



nooneon_noout_runs_df$runsReal<-nooneon_noout_runs_df$runs-nooneon_noout_runs_df$runsbefore
mean(nooneon_noout_runs_df$runsReal)
```

Again, we create a new data set, this one representing the state of "Nobody on, No Outs" in which 

- **runsbefore** is the average amount of runs scored before the given state per inning.

Then, 

- **runsReal** is the average amount of runs scored after the given state per inning.

The average is .656, very similar to the .684 we calculated for every inning. This is because every state starts with "Nobody on, No Outs" and the only other occurence after would have to be after a home run with no outs. The similarity of these statistics speaks to the functionality of the metric, as it is very close but slightly depreciated, which is expected based on lineup shifts and pitching changes after home runs with no outs in an inning. 

```{r}
summary(nooneon_noout_runs_df$runsReal)
hist(nooneon_noout_runs_df$runsReal)
```

There is also very similar distributions and quartile readings for the states, which backs up the aforementioned functionality.

I continued to do this for all of the base-out states, until I recorded all of them and created "Softball's Base-Out state" chart.^{13-39}

```{r}
NoOutsS<-c(.656,1.1,1.39,1.517,1.769,1.948,2.089,2.294)
OneOutS<-c(.301,.603,.770,1.029,1.052,1.244,1.336,1.506)
TwoOutsS<-c(.097,.234,.3006,.411,.454,.495,.566,.616)
baseoutstates
chartS<-data.frame(baseoutstates,NoOutsS,OneOutS,TwoOutsS)

pandoc.table(chartS)
pandoc.table(MLBBOStates)
```


```{r}
standarderrorsNoout<-c(standarderror1,standarderror4,standarderror7,standarderror10,standarderror13,standarderror16,standarderror19,standarderror22)
standarderrorsOneout<-c(standarderror2,standarderror5,standarderror8,standarderror11,standarderror14,standarderror17,standarderror20,standarderror23)
standarderrorsTwoout<-c(standarderror3,standarderror6,standarderror9,standarderror12,standarderror15,standarderror18,standarderror21,standarderror24)
Totalchart<-data.frame(baseoutstates,NoOutsS,OneOutS,TwoOutsS,NoOuts,OneOut,TwoOuts,standarderrorsNoout,standarderrorsOneout,standarderrorsTwoout)
Totalchart$Sig_Noouts<-with(Totalchart, (NoOutsS-NoOuts)/standarderrorsNoout)
Totalchart$Sig_Oneout<-with(Totalchart, (OneOutS-OneOut)/standarderrorsOneout)
Totalchart$Sig_Twoouts<-with(Totalchart, (TwoOutsS-TwoOuts)/standarderrorsTwoout)
Totalchart$Pvalue0<-with(Totalchart, 2*pnorm(-abs(Sig_Noouts)))
Totalchart$Pvalue1<-with(Totalchart, 2*pnorm(-abs(Sig_Oneout)))
Totalchart$Pvalue2<-with(Totalchart, 2*pnorm(-abs(Sig_Twoouts)))
print(Totalchart)
pandoc.table(Totalchart)
```

Individual t-tests show us that the difference in the metrics vary, but there is variance in the p-values that arise from the data. For example, runners on first and third with one out elicits a p-value of .9 — which means that we reject the null hypothesis in that the difference between the softball and MLB coefficient in this specific scenario is different. It is one of nine instances in which the p-value is above alpha: .05, so it is clear that same states are much different than others, and others are similar. 

##Softball's wOBA

Using the same dataset that had the maximum amount of runs, I did the same thing that I did for the base-states but with the unique events as labelled in **playType**. For example,

```{r}

homerun_df<-season[season$playType=="home run",] %>% dplyr::group_by(gameID,inningID,top_bottom) %>% 
 dplyr::summarize(
     runsbefore=mean(runs_before_play,na.rm=T))

homerun_df<- merge(homerun_df,runs_df,all=TRUE,sort=FALSE)
homerun_df$runsReal<-homerun_df$runs-homerun_df$runsbefore
```

**runsbefore** and **runsReal** mean the same thing as before, but now they track the average amount of runs that happen after an event — in this case, HR — per inning.

```{r}
mean(homerun_df$runsReal,na.rm=T)
```

The average for home runs is 2.169, which will be compared to the MLB metric.^{39-54}

```{r}
outvalueMLB<-.240
playvalue<-data.frame(playType,RTOE,run_exp,RTOEMLB,run_expMLB,outvalueMLB,standarderrorsplays)

playvalue$ExpectedGain<-playvalue$RTOE-playvalue$run_exp
playvalue$outvalue<-.296
playvalue$OBAcoeffbase<-with(playvalue, RTOE-outvalue)
playvalue$OBAcoeffbaseMLB<-with(playvalue, RTOEMLB-outvalueMLB)
```

First, we create a dataset with the runs to the end of the inning and the run_exp based on our calculated base-out states and then find 

-**OBAcoeffbase** which is the runs to the end of the inning for an individual event relative to that of an out, unweighted. This can also be read as the run value of the event, as it tracks how many runs it 'creates' compared to if the batter had gotten out. 

```{r}

Softball_Stats2016$oneB<-with(Softball_Stats2016, H-twoB-threeB-HR)

Softball_Stats2016$mybaseOBA<-(.579*Softball_Stats2016$BB+.734*Softball_Stats2016$HBP+.564*Softball_Stats2016$oneB+1.187*Softball_Stats2016$twoB+1.425*Softball_Stats2016$threeB+1.873*Softball_Stats2016$HR+.821*Softball_Stats2016$RBOE)/(Softball_Stats2016$AB+Softball_Stats2016$BB+Softball_Stats2016$IBB+Softball_Stats2016$SH+Softball_Stats2016$SF+Softball_Stats2016$HBP)

mean(Softball_Stats2016$mybaseOBA)
Softball_Stats2016$OBP<-(Softball_Stats2016$BB+Softball_Stats2016$HBP+Softball_Stats2016$oneB+Softball_Stats2016$twoB+Softball_Stats2016$threeB+Softball_Stats2016$HR)/(Softball_Stats2016$AB+Softball_Stats2016$BB+Softball_Stats2016$IBB+Softball_Stats2016$SH+Softball_Stats2016$SF+Softball_Stats2016$HBP)
mean(Softball_Stats2016$OBP)
mean(Softball_Stats2016$OBP)/mean(Softball_Stats2016$mybaseOBA)

playvalue$OBAcoeff<-with(playvalue, OBAcoeffbase*1.23)
playvalue$OBAcoeffMLB<-with(playvalue, OBAcoeffbaseMLB*1.15)
print(playvalue)
```

After, in order to equate our wOBA to a percentage with a similar distribution and league-average as 

-**OBP** on-base percentage,

so I created 

-**OBAcoeff** the official wOBA coefficients taken from the Softball season data.


  {my wOBA}    (.69*  {Singles} + 1.46*  {Doubles} + 1.75*  {Triples} + 2.30*  {Home runs} + .90*  {Hit-By-Pitches} + .71*  {Walks} +1.01*  
  {Reached Base on Error}) /   {Plate Appearances}

```{r}
playvalue$standerrorsweighted<-with(playvalue, standarderrorsplays*sqrt(1.23))
playvalue$ExpectedGainMLB<-playvalue$RTOEMLB-playvalue$run_expMLB
playvalue$z<-with(playvalue, (ExpectedGain-ExpectedGainMLB)/(standerrorsweighted))
playvalue$pvalue<-with(playvalue, 2*pnorm(-abs(z)))
print(pandoc.table(playvalue))
```

As we can see from the standard errors created for each of the playTypes — which were then weighted according to the weight applied to base OBA coefficients — there is a wide variance in the significance in the differences between the MLB and softball runs to the end of an inning relative to the expected run total before the play. These pvalues we treat individually, so pvalue below .05 represents an insignificant change — as we can see for walks. ^{55}

```{r}
playvalue$pvalue[playvalue$playType=="error"]
```

A pvalue of .1247 is greater than an alpha of .05, so we reject the null hypothesis that we touched on earlier that errors would represent a different amount of runs in softball than in baseball. 

```{r}
playvalue$pvalue[playvalue$playType=="single"]
```

However, we see such a small p value for singles that we not only fail to reject the null hypothesis that singles are represented similarly in their effect on runs scored, but I'm taking notice of how significant the difference really is. 

##Application

- **myOBA** a measure of each individual team's OBA based on the constants and coefficients I calculated


```{r}

lmmwSoftballOBA2016<-lm(with(Softball_Stats2016, PCT~myOBA))
lmmwSoftballOBA2016
rsquared(lmmwSoftballOBA2016)
lmmwSoftballOBA2016R<-lm(with(Softball_Stats2016, R~myOBA))
lmmwSoftballOBA2016R
rsquared(lmmwSoftballOBA2016R)
```

As we can see, the r-squared values for this new statistic are very close to the original ones, despite the constants being very different for the most part. 

```{r}

Softball_Stats2016$fit <- predict(lmmwSoftballOBA2016R)
Softball_Stats2016$ul <- Softball_Stats2016$fit + 1.96 * predict(lmmwSoftballOBA2016R, se.fit = T)$se
Softball_Stats2016$ll <- Softball_Stats2016$fit - 1.96 * predict(lmmwSoftballOBA2016R, se.fit = T)$se

plot<-ggplot(data = Softball_Stats2016, aes(x=myOBA,y=fit))+geom_line()+geom_ribbon(aes(ymin = ll, ymax = ul), col = "grey", alpha = 0.25) + labs(x = "myOBA", y = "Predicted Runs Scored", main = "myOBA Function Fit")
plot

Softball_Stats2016$fit2 <- predict(lmwSoftballOBA2016R)
Softball_Stats2016$ul2 <- Softball_Stats2016$fit2 + 1.96 * predict(lmwSoftballOBA2016R, se.fit = T)$se
Softball_Stats2016$ll2 <- Softball_Stats2016$fit2 - 1.96 * predict(lmwSoftballOBA2016R, se.fit = T)$se
plot2<-ggplot(data = Softball_Stats2016, aes(x=wOBA,y=fit2))+geom_line()+geom_ribbon(aes(ymin = ll2, ymax = ul2), col = "grey", alpha = 0.25) + labs(x = "wOBA", y = "Predicted Runs Scored", main = "wOBA Function Fit")
plot2

```

In comparing the two models graphically, including confidence intervals, it is clear that they follow a very similar pattern — as they should. One thing to notice in particular is the tightness of the interval in the middle, which is also observed when evaluating the proximity of the observations to the predictions displayed by the linear equation itself.

```{r}
  
 #Looking at the distribution of Softball wOBAs, looks normal
hist(Softball_Stats2016$myOBA)
range(Softball_Stats2016$myOBA)
count(Softball_Stats2016$myOBA>=.400)
count(BaseballOStats2016$wOBA>=.400)
count(BaseballOStats2016$wOBA>=.400)/length(BaseballOStats2016$Institution)
count(Softball_Stats2016$myOBA>=.400)/length(Softball_Stats2016$Institution)

#Plot the function with the dataset
plot(x= Softball_Stats2016$myOBA, y=Softball_Stats2016$R,
     xlab="myOBA", ylab = "R")
abline(lmmwSoftballOBA2016R,col="red")
rsquared(lmmwSoftballOBA2016R)
```

Looking at the distribution of myOBAs, it is normal in a very similar fashion to wOBA, which is to be expected. However, as the scales and constants were changed for softball, there is a similar range as well. According to "The Book"_{1}, great MLB teams eclipse .400; however, it seems that it is more common for softball teams than baseball teams at least — 10 percent of teams accrued myOBA percentages above 400, compared to 1.4 percent of baseball teams for wOBA. However, 10 percent of MLB teams would be only three teams, so it seems fair to label a myOBA of over .400 as top-tier. 

```{r}
rsquared(lmmwSoftballOBA2016R)
rsquared(lmwSoftballOBA2016R)
rsquared(lmmwSoftballOBA2016)
rsquared(lmwSoftballOBA2016)
SEmyModel<-mean(predict(lmwSoftballOBA2016R, se.fit = T)$se)
SEwModel<-mean(predict(lmmwSoftballOBA2016R, se.fit = T)$se)
dfmodel<-(length(Softball_Stats2016$Institution)-1)+(length(BaseballOStats2016$Institution)-1)
dfmodel
coef(lmmwSoftballOBA2016)[2]-coef(lmwSoftballOBA2016)[2]/((SEmyModel^2)+(SEwModel^2)) 
```

With an alpha set at 1.96, which represents the t-statistic for degrees of freedom 592 in the comparison of these two sample coefficients, we reject the null hypothesis that the slopes similarly describe softball. Of course, any difference in the slopes has to do with the changes in constants; however, this tells us that it is statistically significant that the two are predicting runs scored as a different factor of the given OBA statistic. 

*I repeated this process for 2015 and 2014 in the code appendix. The results are eerily similar, and the difference between the rsquared values get even more narrow. In fact, for 2014, the difference between rsquared variables is .0078.^{56}

```{r}
lmmwSoftballOBA2015R
plot3<-ggplot(data = Softball_Stats2015, aes(x=myOBA,y=fit2))+geom_line()+geom_ribbon(aes(ymin = ll2, ymax = ul2), col = "grey", alpha = 0.25) + labs(x = "myOBA", y = "Predicted Runs Scored", main = "myOBA Function Fit 2015")
plot3

lmmwSoftballOBA2014R
plot4<-ggplot(data = Softball_Stats2014, aes(x=myOBA,y=fit2))+geom_line()+geom_ribbon(aes(ymin = ll2, ymax = ul2), col = "grey", alpha = 0.25) + labs(x = "myOBA", y = "Predicted Runs Scored", main = "myOBA Function Fit 2014")
plot4
```

# Discussion

There are many takeaways to be had from the results of the analysis. For the three sections, we can extrapolate three important facts for further interpretation:

Run Expectancy Chart

The difference in results among the two charts in Softball and the MLB is both evident and — despite the fact that there is no difference in some cases — it is clear that having two outs is a much more dire circumstance in softball than in baseball. Only one value in Sig_Twoouts is non-negative, "Runner on Third", and it isn't significant at alpha: .05, so even that could be the result of error.

However, base-states with zero or one outs have almost uniformly higher metrics and a significant percentage are significantly more. One theory behind this logic is that there are more runs scored per game in softball than in baseball, which seems to be true. 

```{r}
Softball_Stats2016$RPG<-Softball_Stats2016$R/Softball_Stats2016$AB
mean(Softball_Stats2016$RPG)
BaseballOStats2016$RPG<-BaseballOStats2016$R/BaseballOStats2016$AB
mean(BaseballOStats2016$RPG)
```

However, that didn't stop the two outs metric to be deflated on average, other than if a runner was on third with two outs. Physically, a run only requires moving a runner 60 feet as opposed to 90, so that might explain the statistically non-significant difference in the two metrics. 

There are three non-negative z statistics for a non-two out base-state, which are Bases Loaded, No outs; Runners on 2nd and 3rd, One out and Bases Loaded, One out. This may signal decision-makers to place a heavier emphasis on getting the first batter on base, for example, or choosing to intentionally walk good players more often in order to take advantage of common misconceptions about softball's similarity to baseball. 

One of the most interesting things to look at here are the differences when the states change. If a runner is on first and second with no one out, how many runs is the team expected to get if a player has a 2% chance of getting a double and a 30% chance of beating out a bunt single? What stolen base percentage would a baserunner have to have and what batting average would the batter have to have in order to justify stealing a base? When do you intentional walk a player? These are just two of the infinite amount of questions that could be statistically evaluated by coaches before the game even starts. 

One of the most translatable examples of this is the jump from Runner on 3rd to Runners on 1st and 3rd with no outs. A lot of softball teams rely on the suicide squeeze to get runners from third in and give up an out, reducing a base-state of 1.517 to get a run but create a base-state that only expects an additional .301 runs. 1.517 > 1+.301, and losing .2 runs a game would add up over a season of 60-plus games for good teams. 

If a runner is on first in a one-run game with two outs and the batter can get that runner in from 1st 2% of the time and from 2nd 30% of the time, would you decide to steal?

No. The batter is expected to score the runner from 1st 2 percent of the time, and the change in run expectancy from "Runner on 1st, Two outs" to "Runner on 2nd, Two outs" is .067. The steal gives you a 90% chance to get that gain, so the expected run gain is now .0603. The chance you can capitalize on the expected run gain is 30% * .0603, which is .018 expected run gain — below .02.


Softball's wOBA

The depreciated value of the single steals the headlines in this section, as the pvalue pushes the limits of nonzero. We already demonstrated that softball sees many more singles than baseball; however, that alone cannot account for the difference. In my opinion, many more singles occur in softball that do not leave the infield and do not advance runners and thus do not create runs than in baseball. This principle could signal a loss in value for small-ball players that rely on speed and beating out "slaps", a popular play in softball. 

In fact, with double and triple having insignificant differences compared to the MLB's value, the single stands out even more. The strikeout is also much more significant in softball than in baseball, which makes sense given the ease in which runners can advance in softball compared to baseball. 

Interestingly, the much-maligned SAC bunt is significantly worse in softball, and the decrease from the initial run expectancy is higher. If anything, this could be the result of human scoring error, as slaps are typically labelled bunts when the batter is thrown out at first. But, if you consider this metric a combination of bunts and slaps that end in sacrifices, then you have to consider reevaluating making the decision to ever slap/bunt sacrifice. 

Another theme across all of these sections is the significant weight of a home run. Softball stadiums are typically 200 feet, while MLB and college stadiums can get to over 400 feet in center. The difference in sheer area in outfields between the two sports is significant, and a smaller outfield could contribute in keeping double/triple RTOE rates near the MLB's. But home runs are the great equalizer in that no fielder can do anything different to limit the runs created by a home run, so the difference might be a true reflection of the fact that there are more runs scored in softball than in baseball. That, or softball players hit more home runs:

```{r}
Softball_Stats2016$HRPG<-Softball_Stats2016$HR/Softball_Stats2016$AB
mean(Softball_Stats2016$HRPG)
BaseballOStats2016$HRPG<-BaseballOStats2016$HR/BaseballOStats2016$AB
mean(BaseballOStats2016$HRPG)
Softball_Stats2016$ABPG<-Softball_Stats2016$AB/Softball_Stats2016$G
mean(Softball_Stats2016$ABPG)
```

A .00096 difference in HRs per AB is fairly significant when considering that there are about 52 ABs per team in a given game, which means that that there is about one more home run hit every twenty games in softball than in baseball. In a dataset with 2000 games, that's 100 more home runs. Either way, it's clear that softball has a greater reliance on home runs for runs than does baseball. Home run hitters are very valuable in softball. 

The data on plays can help coaches recruit or coach third base, when they usually inform the baserunner and batter what to do. With this information, I would be less inclined to have a slapper slap as opposed to swing away; I might let a home-run hitter swing at a 3-0 pitch and I might recruit players such as to place a higher value on hitting the ball hard because doubles, triples and home runs are all more valuable in softball than in baseball.

Application

\[
  {my wOBA}    (.69*  {Singles} + 1.46*  {Doubles} +  1.75*  {Triples} + 2.30*  {Home runs} + .90*  {Hit-By-Pitches} + .71*  {Walks} + 1.01*  {Reached Base on Error}) /  {Plate Appearances} \]

Looking at my wOBA statistic, the comparison between the changes in the constants from the MLB equation to the softball version aligns with the inflation in runs scored and the depreciation of events like the single and the walk in particular.

The applications of this in the analysis section are well-documented and discussed, and the rsquared values are not only strong but very close to the baseball-optimized wOBA. However, this project is largely about the derivation of those constants and the function's applicability both for evaluating players and making decisions in games and during the course of a season. With that being said, my top three optimization opportunities in the game of softball based on these results: 

1) Recruit players that don't just rely on their speed to get on base. Singles that don't leave the infield not only necessitate incredible talent to result in singles in the first place, and those likely don't move non-forced runners, which is a major portion of the game. 

2) The differences in the base-out states make a huge difference when evaluating when to intentional walk a player or when to — for example — pinch hit a batter late in a game. The intentional walk can be an important tool when a good player is up in an advantageous base-out state; however, the depreciation for bases loaded states might lend the fielding team an opportunity to create an out with a well-timed intentional walk. Also, being mindful of these base-states on the fly and the expected values based on the batter will always create windows for optimization of hitters during a game. For example, a slapper up with runners on first and second might be disadvantageous compared to a low-average power hitter, which would let a coach make a timely substition. 

3) Never SAC bunt. It goes without saying in the big leagues after Moneyball, and that should catch on in softball. The SAC bunt creates an out, which crushes expected run totals when a SAC makes the second out, and, if you followed steps one and two, the batter should be able to get the ball out of the infield at a decent enough rate to justify seining away in nearly every scenario. 

# Bibliography

— Tango (Author), Mitchel Lichtman (Author),, Tom. "The Book: Playing The Percentages In Baseball Paperback – April 28, 2014." The Book: Playing The Percentages In Baseball: Tom Tango, Mitchel Lichtman, Andrew Dolphin: 9781494260170: Amazon.com: Books. N.p., n.d. Web. 24 Apr. 2017.

— Nachtigal, Jon. "Softball’s Top 10 Teams and Weighted On-Base Average (wOBA)." Fastpitch Analytics. N.p., 15 May 2013. Web. 15 May 2017.

— NCAA. NCAA Softball Statistics. Raw data. Indianapolis, Indiana.

— Octonion. NCAA softball play-by-play data. 2016. Raw data. Github.com.

##For fun

```{r}
Softball_Stats2016$RPG<-((Softball_Stats2016$R)/(Softball_Stats2016$G))
forfun<-lm(with(Softball_Stats2016, PCT~RPG))
forfun
mean(nooneon_noout_runs_df$runsReal)
7*mean(nooneon_noout_runs_df$runsReal)
.13026+(.08037*4.589682)
```



